/*
 2015
 @license MIT-style
 2014-2016
 @license MIT-style

 @param {YUVFrame} buffer - input frame buffer
 @param {Uint8ClampedArray} output - array to draw RGBA into
 Assumes that the output array already has alpha channel set to opaque.
 2016
 @license MIT-style

 @param {number} ratio - the integer ratio to convert.
 @returns {number} - number of bits to shift to multiply/divide by the ratio.
 @throws exception if given a non-power-of-two
 (c) 2013-2016 Brion Vibber
 @license MIT
 @overview es6-promise - a tiny implementation of Promises/A+.
 @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 @license   Licensed under MIT license
            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 @version   4.1.0
*/
(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory();else if(typeof define==="function"&&define.amd)define([],factory);else if(typeof exports==="object")exports["ogvjs"]=factory();else root["ogvjs"]=factory()})(this,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]=
{exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0)}([function(module,exports,__webpack_require__){var OGVCompat=__webpack_require__(1),OGVLoader=__webpack_require__(3),OGVMediaType=__webpack_require__(7),OGVPlayer=__webpack_require__(8),OGVVersion="1.4.2-20170425024925-504d7197";
if(window){window.OGVCompat=OGVCompat;window.OGVLoader=OGVLoader;window.OGVMediaType=OGVMediaType;window.OGVPlayer=OGVPlayer;window.OGVVersion=OGVVersion}module.exports={OGVCompat:OGVCompat,OGVLoader:OGVLoader,OGVMediaType:OGVMediaType,OGVPlayer:OGVPlayer,OGVVersion:OGVVersion}},function(module,exports,__webpack_require__){var BogoSlow=__webpack_require__(2);var OGVCompat={benchmark:new BogoSlow,hasTypedArrays:function(){return!!window.Uint32Array},hasWebAudio:function(){return!!(window.AudioContext||
window.webkitAudioContext)},hasFlash:function(){if(navigator.userAgent.indexOf("Trident")!==-1)try{var obj=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");return true}catch(e){return false}return false},hasAudio:function(){return this.hasWebAudio()||this.hasFlash()},isBlacklisted:function(userAgent){var blacklist=[/\(i.* OS [67]_.* like Mac OS X\).* Mobile\/.* Safari\//,/\(Macintosh.* Version\/6\..* Safari\/\d/];var blacklisted=false;blacklist.forEach(function(regex){if(userAgent.match(regex))blacklisted=
true});return blacklisted},isSlow:function(){return this.benchmark.slow},isTooSlow:function(){return this.benchmark.tooSlow},supported:function(component){if(component==="OGVDecoder")return this.hasTypedArrays()&&!this.isBlacklisted(navigator.userAgent);if(component==="OGVPlayer")return this.supported("OGVDecoder")&&this.hasAudio()&&!this.isTooSlow();return false}};module.exports=OGVCompat},function(module,exports){function BogoSlow(){var self=this;var timer;if(window.performance&&window.performance.now)timer=
function(){return window.performance.now()};else timer=function(){return Date.now()};var savedSpeed=null;function run(){var ops=0;var fibonacci=function(n){ops++;if(n<2)return n;else return fibonacci(n-2)+fibonacci(n-1)};var start=timer();fibonacci(30);var delta=timer()-start;savedSpeed=ops/delta}Object.defineProperty(self,"speed",{get:function(){if(savedSpeed===null)run();return savedSpeed}});Object.defineProperty(self,"slowCutoff",{get:function(){return 5E4}});Object.defineProperty(self,"tooSlowCutoff",
{get:function(){return 0}});Object.defineProperty(self,"slow",{get:function(){return self.speed<self.slowCutoff}});Object.defineProperty(self,"tooSlow",{get:function(){return self.speed<self.tooSlowCutoff}})}module.exports=BogoSlow},function(module,exports,__webpack_require__){var OGVVersion="1.4.2-20170425024925-504d7197";(function(){var global=this;var scriptMap={OGVDemuxerOgg:"ogv-demuxer-ogg.js",OGVDemuxerOggW:"ogv-demuxer-ogg-wasm.js",OGVDemuxerWebM:"ogv-demuxer-webm.js",OGVDemuxerWebMW:"ogv-demuxer-webm-wasm.js",
OGVDecoderAudioOpus:"ogv-decoder-audio-opus.js",OGVDecoderAudioOpusW:"ogv-decoder-audio-opus-wasm.js",OGVDecoderAudioVorbis:"ogv-decoder-audio-vorbis.js",OGVDecoderAudioVorbisW:"ogv-decoder-audio-vorbis-wasm.js",OGVDecoderVideoTheora:"ogv-decoder-video-theora.js",OGVDecoderVideoTheoraW:"ogv-decoder-video-theora-wasm.js",OGVDecoderVideoVP8:"ogv-decoder-video-vp8.js",OGVDecoderVideoVP8W:"ogv-decoder-video-vp8-wasm.js",OGVDecoderVideoVP8MT:"ogv-decoder-video-vp8-mt.js",OGVDecoderVideoVP9:"ogv-decoder-video-vp9.js",
OGVDecoderVideoVP9W:"ogv-decoder-video-vp9-wasm.js",OGVDecoderVideoVP9MT:"ogv-decoder-video-vp9-mt.js"};var proxyTypes={OGVDecoderAudioOpus:"audio",OGVDecoderAudioOpusW:"audio",OGVDecoderAudioVorbis:"audio",OGVDecoderAudioVorbisW:"audio",OGVDecoderVideoTheora:"video",OGVDecoderVideoTheoraW:"video",OGVDecoderVideoVP8:"video",OGVDecoderVideoVP8W:"video",OGVDecoderVideoVP9:"video",OGVDecoderVideoVP9W:"video"};var proxyInfo={audio:{proxy:__webpack_require__(4),worker:"ogv-worker-audio.js"},video:{proxy:__webpack_require__(6),
worker:"ogv-worker-video.js"}};function urlForClass(className){var scriptName=scriptMap[className];if(scriptName)return urlForScript(scriptName);else throw new Error("asked for URL for unknown class "+className);}function urlForScript(scriptName){if(scriptName){var base=OGVLoader.base;if(base===undefined)base="";else base+="/";return base+scriptName+"?version="+encodeURIComponent(OGVVersion)}else throw new Error("asked for URL for unknown script "+scriptName);}var scriptStatus={},scriptCallbacks=
{};function loadWebScript(src,callback){if(scriptStatus[src]=="done")callback();else if(scriptStatus[src]=="loading")scriptCallbacks[src].push(callback);else{var done=function(event){var callbacks=scriptCallbacks[src];delete scriptCallbacks[src];scriptStatus[src]="done";callbacks.forEach(function(cb){cb()})};scriptStatus[src]="loading";scriptCallbacks[src]=[callback];var scriptNode=document.createElement("script");scriptNode.addEventListener("load",done);scriptNode.addEventListener("error",done);
scriptNode.src=src;document.querySelector("head").appendChild(scriptNode)}}function loadWebAssembly(src,callback){if(!src.match(/-wasm\.js/))callback(null);else{var wasmSrc=src.replace(/-wasm\.js/,"-wasm.wasm");var xhr=new XMLHttpRequest;xhr.responseType="arraybuffer";xhr.onload=function(){callback(xhr.response)};xhr.onerror=function(){callback(null)};xhr.open("GET",wasmSrc);xhr.send()}}function defaultBase(){if(typeof global.window==="object"){var scriptNodes=document.querySelectorAll("script"),
regex=/^(?:|(.*)\/)ogv(?:-support)?\.js(?:\?|#|$)/,path,matches;for(var i=0;i<scriptNodes.length;i++){path=scriptNodes[i].getAttribute("src");if(path){matches=path.match(regex);if(matches)return matches[1]}}return undefined}else return undefined}var OGVLoader={base:defaultBase(),loadClass:function(className,callback,options){options=options||{};if(options.worker){this.workerProxy(className,callback);return}var url=urlForClass(className);loadWebAssembly(url,function(wasmBinary){function wasmClassWrapper(options){options=
options||{};if(wasmBinary!==null)options.wasmBinary=wasmBinary;return new global[className](options)}if(typeof global[className]==="function")callback(wasmClassWrapper);else if(typeof global.window==="object")loadWebScript(url,function(){callback(wasmClassWrapper)});else if(typeof global.importScripts==="function"){global.importScripts(url);callback(wasmClassWrapper)}})},workerProxy:function(className,callback){var proxyType=proxyTypes[className],info=proxyInfo[proxyType];if(!info)throw new Error("Requested worker for class with no proxy: "+
className);var proxyClass=info.proxy,workerScript=info.worker,codecUrl=urlForScript(scriptMap[className]),workerUrl=urlForScript(workerScript),worker;var construct=function(options){return new proxyClass(worker,className,options)};if(workerUrl.match(/^https?:|\/\//i)){var completionCheck=function(){if(codecLoaded==true&&workerLoaded==true){try{blob=new Blob([codecResponse+" "+workerResponse],{type:"application/javascript"})}catch(e){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||
window.MozBlobBuilder;blob=new BlobBuilder;blob.append(codecResponse+" "+workerResponse);blob=blob.getBlob()}worker=new Worker(URL.createObjectURL(blob));callback(construct)}};var getCodec,getWorker,codecResponse,workerResponse,codecLoaded=false,workerLoaded=false,blob;getCodec=new XMLHttpRequest;getCodec.open("GET",codecUrl,true);getCodec.onreadystatechange=function(){if(getCodec.readyState==4&&getCodec.status==200){codecResponse=getCodec.responseText;codecLoaded=true;completionCheck()}};getCodec.send();
getWorker=new XMLHttpRequest;getWorker.open("GET",workerUrl,true);getWorker.onreadystatechange=function(){if(getWorker.readyState==4&&getWorker.status==200){workerResponse=getWorker.responseText;workerLoaded=true;completionCheck()}};getWorker.send()}else{worker=new Worker(workerUrl);callback(construct)}}};module.exports=OGVLoader})()},function(module,exports,__webpack_require__){var OGVProxyClass=__webpack_require__(5);var OGVDecoderAudioProxy=OGVProxyClass({loadedMetadata:false,audioFormat:null,
audioBuffer:null,cpuTime:0},{init:function(callback){this.proxy("init",[],callback)},processHeader:function(data,callback){this.proxy("processHeader",[data],callback,[data])},processAudio:function(data,callback){this.proxy("processAudio",[data],callback,[data])},close:function(){this.terminate()}});module.exports=OGVDecoderAudioProxy},function(module,exports){function OGVProxyClass(initialProps,methods){return function(worker,className,options){options=options||{};var self=this;var transferables=
function(){var buffer=new ArrayBuffer(1024),bytes=new Uint8Array(buffer);try{worker.postMessage({action:"transferTest",bytes:bytes},[buffer]);if(buffer.byteLength)return false;else return true}catch(e){return false}}();var props={};for(var iPropName in initialProps)if(initialProps.hasOwnProperty(iPropName))(function(propName){props[propName]=initialProps[propName];Object.defineProperty(self,propName,{get:function getProperty(){return props[propName]}})})(iPropName);var processingQueue=0;Object.defineProperty(self,
"processing",{get:function(){return processingQueue>0}});for(var method in methods)if(methods.hasOwnProperty(method))self[method]=methods[method];var messageCount=0,pendingCallbacks={};this.proxy=function(action,args,callback,transfers){if(!worker)throw'Tried to call "'+action+'" method on closed proxy object';var callbackId="callback-"+ ++messageCount+"-"+action;if(callback)pendingCallbacks[callbackId]=callback;var out={"action":action,"callbackId":callbackId,"args":args||[]};processingQueue++;if(transferables)worker.postMessage(out,
transfers||[]);else worker.postMessage(out)};this.terminate=function(){if(worker){worker.terminate();worker=null;processingQueue=0;pendingCallbacks={}}};worker.addEventListener("message",function proxyOnMessage(event){processingQueue--;if(event.data.action!=="callback")return;var data=event.data,callbackId=data.callbackId,args=data.args,callback=pendingCallbacks[callbackId];if(data.props)for(var propName in data.props)if(data.props.hasOwnProperty(propName))props[propName]=data.props[propName];if(callback){delete pendingCallbacks[callbackId];
callback.apply(this,args)}});self.proxy("construct",[className,options],function(){});return self}}module.exports=OGVProxyClass},function(module,exports,__webpack_require__){var OGVProxyClass=__webpack_require__(5);var OGVDecoderVideoProxy=OGVProxyClass({loadedMetadata:false,videoFormat:null,frameBuffer:null,cpuTime:0},{init:function(callback){this.proxy("init",[],callback)},processHeader:function(data,callback){this.proxy("processHeader",[data],callback,[data])},processFrame:function(data,callback){this.proxy("processFrame",
[data],callback,[data])},close:function(){this.terminate()}});module.exports=OGVDecoderVideoProxy},function(module,exports){function OGVMediaType(contentType){contentType=""+contentType;var self=this;self.major=null;self.minor=null;self.codecs=null;function trim(str){return str.replace(/^\s+/,"").replace(/\s+$/,"")}function split(str,sep,limit){var bits=str.split(sep,limit).map(function(substr){return trim(substr)});if(typeof limit==="number")while(bits.length<limit)bits.push(null);return bits}var parts=
split(contentType,";");if(parts.length){var base=parts.shift();if(base){var bits=split(base,"/",2);self.major=bits[0];self.minor=bits[1]}parts.forEach(function(str){var matches=str.match(/^codecs\s*=\s*"(.*?)"$/);if(matches)self.codecs=split(matches[1],",")})}}module.exports=OGVMediaType},function(module,exports,__webpack_require__){__webpack_require__(9).polyfill();var YUVCanvas=__webpack_require__(12);var OGVLoader=__webpack_require__(3);var StreamFile=__webpack_require__(19);var AudioFeeder=__webpack_require__(30),
dynamicaudio_swf=__webpack_require__(31);var Bisector=__webpack_require__(32);var OGVMediaType=__webpack_require__(7);var OGVWrapperCodec=__webpack_require__(33);var OGVDecoderAudioProxy=__webpack_require__(4);var OGVDecoderVideoProxy=__webpack_require__(6);var OGVTimeRanges=window.OGVTimeRanges=function(ranges){Object.defineProperty(this,"length",{get:function getLength(){return ranges.length}});this.start=function(i){return ranges[i][0]};this.end=function(i){return ranges[i][1]};return this};var OGVMediaErrorConstants=
{MEDIA_ERR_ABORTED:1,MEDIA_ERR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4};function extend(dest,src){for(prop in src)if(src.hasOwnProperty(prop))dest[prop]=src[prop]}var OGVMediaError=window.OGVMediaError=function(code,message){this.code=code;this.message=message};extend(OGVMediaError,OGVMediaErrorConstants);extend(OGVMediaError.prototype,OGVMediaErrorConstants);var OGVPlayer=function(options){options=options||{};var instanceId="ogvjs"+ ++OGVPlayer.instanceCount;var codecClass=null,
codecType=null;var canvasOptions={};if(options.webGL!==undefined)canvasOptions.webGL=options.webGL;if(!!options.forceWebGL)canvasOptions.webGL="required";var enableWebM=!!options.enableWebM;var enableWorker=!!window.Worker;if(typeof options.worker!=="undefined")enableWorker=!!options.worker;var enableThreading=!!options.threading;var enableWASM=!!options.wasm;if(options.sync===undefined)options.sync="skip-frames";var State={INITIAL:"INITIAL",SEEKING_END:"SEEKING_END",LOADED:"LOADED",PRELOAD:"PRELOAD",
READY:"READY",PLAYING:"PLAYING",SEEKING:"SEEKING",ENDED:"ENDED",ERROR:"ERROR"},state=State.INITIAL;var SeekState={NOT_SEEKING:"NOT_SEEKING",BISECT_TO_TARGET:"BISECT_TO_TARGET",BISECT_TO_KEYPOINT:"BISECT_TO_KEYPOINT",LINEAR_TO_TARGET:"LINEAR_TO_TARGET"},seekState=SeekState.NOT_SEEKING;var audioOptions={},codecOptions={};options.base=options.base||OGVLoader.base;if(typeof options.base==="string"){audioOptions.base=options.base;codecOptions.base=options.base}if(typeof options.audioContext!=="undefined")audioOptions.audioContext=
options.audioContext;if(typeof options.audioDestination!=="undefined")audioOptions.output=options.audioDestination;audioOptions.bufferSize=8192;codecOptions.worker=enableWorker;codecOptions.threading=enableThreading;codecOptions.wasm=enableWASM;if(typeof options.memoryLimit==="number")codecOptions.memoryLimit=options.memoryLimit;var canvas=document.createElement("canvas");var frameSink;var self=document.createElement("ogvjs");self.className=instanceId;extend(self,constants);canvas.style.position=
"absolute";canvas.style.top="0";canvas.style.left="0";canvas.style.width="100%";canvas.style.height="100%";canvas.style.objectFit="contain";self.appendChild(canvas);var getTimestamp;if(window.performance===undefined||window.performance.now===undefined)getTimestamp=Date.now;else getTimestamp=window.performance.now.bind(window.performance);function time(cb){var start=getTimestamp();cb();var delta=getTimestamp()-start;lastFrameDecodeTime+=delta;return delta}var then=getTimestamp();function log(msg){if(options.debug){var now=
getTimestamp(),delta=now-then;if(!options.debugFilter||msg.match(options.debugFilter))console.log("["+Math.round(delta*10)/10+"ms] "+msg)}}function fireEvent(eventName,props){log("fireEvent "+eventName);var event;props=props||{};var standard=typeof window.Event=="function";if(standard)event=new CustomEvent(eventName);else{event=document.createEvent("Event");event.initEvent(eventName,false,false)}for(var prop in props)if(props.hasOwnProperty(prop))event[prop]=props[prop];var allowDefault=self.dispatchEvent(event);
if(!standard&&eventName==="resize"&&self.onresize&&allowDefault)self.onresize.call(self,event)}function fireEventAsync(eventName,props){log("fireEventAsync "+eventName);setTimeout(function(){fireEvent(eventName,props)},0)}var codec=null,videoInfo=null,audioInfo=null,actionQueue=[],audioFeeder=null;var muted=false,initialPlaybackPosition=0,initialPlaybackOffset=0,prebufferingAudio=false,stoppedForLateFrame=false,initialSeekTime=0;function initAudioFeeder(){audioFeeder=new AudioFeeder(audioOptions);
audioFeeder.init(audioInfo.channels,audioInfo.rate);audioFeeder.bufferThreshold=1;audioFeeder.volume=self.volume;audioFeeder.muted=self.muted;audioFeeder.onbufferlow=function audioCallback(){log("onbufferlow");if(stream&&(stream.buffering||stream.seeking)||pendingAudio);else pingProcessing()};audioFeeder.onstarved=function(){if(dataEnded)log("onstarved: appear to have reached end of audio");else{log("onstarved: halting audio due to starvation");stopPlayback();prebufferingAudio=true}if(isProcessing());
else pingProcessing(0)}}function startPlayback(offset){if(audioFeeder){audioFeeder.start();var state=audioFeeder.getPlaybackState();initialPlaybackPosition=state.playbackPosition}else initialPlaybackPosition=getTimestamp()/1E3;if(offset!==undefined)initialPlaybackOffset=offset;prebufferingAudio=false;stoppedForLateFrame=false;log("continuing at "+initialPlaybackPosition+", "+initialPlaybackOffset)}function stopPlayback(){initialPlaybackOffset=getPlaybackTime();log("pausing at "+initialPlaybackOffset);
if(audioFeeder)audioFeeder.stop()}function getPlaybackTime(state){if(prebufferingAudio||stoppedForLateFrame||paused)return initialPlaybackOffset;else{var position;if(audioFeeder){state=state||audioFeeder.getPlaybackState();position=state.playbackPosition}else position=getTimestamp()/1E3;return position-initialPlaybackPosition+initialPlaybackOffset}}var currentSrc="",stream,streamEnded=false,seekCancel={},readCancel={},mediaError=null,dataEnded=false,byteLength=0,duration=null,lastSeenTimestamp=null,
nextProcessingTimer,nextFrameTimer=null,loading=false,started=false,paused=true,ended=false,startedPlaybackInDocument=false;var framesPlayed=0;var framesProcessed=0,targetPerFrameTime=1E3/60,actualPerFrameTime=0,totalFrameTime=0,totalFrameCount=0,playTime=0,bufferTime=0,drawingTime=0,proxyTime=0,totalJitter=0;var droppedAudio=0,delayedAudio=0,lateFrames=0;var poster="",thumbnail;function stopVideo(){log("STOPPING");state=State.INITIAL;seekState=SeekState.NOT_SEEKING;started=false;ended=false;frameEndTimestamp=
0;audioEndTimestamp=0;lastFrameDecodeTime=0;stoppedForLateFrame=false;prebufferingAudio=false;actionQueue.splice(0,actionQueue.length);if(stream){stream.abort();stream=null;streamEnded=false}if(codec){codec.close();codec=null;pendingFrame=0;pendingAudio=0;dataEnded=false}videoInfo=null;audioInfo=null;if(audioFeeder){audioFeeder.close();audioFeeder=null}if(nextProcessingTimer){clearTimeout(nextProcessingTimer);nextProcessingTimer=null}if(nextFrameTimer){clearTimeout(nextFrameTimer);nextFrameTimer=
null}if(frameSink){frameSink.clear();frameSink=null}if(decodedFrames)decodedFrames=[];if(pendingFrames)pendingFrames=[];initialSeekTime=0;initialPlaybackPosition=0;initialPlaybackOffset=0;duration=null}var lastFrameTime=getTimestamp(),frameEndTimestamp=0,audioEndTimestamp=0,decodedFrames=[],pendingFrames=[];var lastFrameDecodeTime=0,lastFrameVideoCpuTime=0,lastFrameAudioCpuTime=0,lastFrameDemuxerCpuTime=0,lastFrameDrawingTime=0,lastFrameBufferTime=0,lastFrameProxyTime=0,lastVideoCpuTime=0,lastAudioCpuTime=
0,lastDemuxerCpuTime=0,lastBufferTime=0,lastProxyTime=0,lastDrawingTime=0;var lastFrameTimestamp=0,currentVideoCpuTime=0;var lastTimeUpdate=0,timeUpdateInterval=250;function doFrameComplete(data){data=data||{};if(startedPlaybackInDocument&&!document.body.contains(self))setTimeout(function(){self.stop()},0);var newFrameTimestamp=getTimestamp(),wallClockTime=newFrameTimestamp-lastFrameTimestamp,jitter=actualPerFrameTime-targetPerFrameTime;totalJitter+=Math.abs(jitter);playTime+=wallClockTime;var timing=
{cpuTime:lastFrameDecodeTime,drawingTime:drawingTime-lastFrameDrawingTime,bufferTime:bufferTime-lastFrameBufferTime,proxyTime:proxyTime-lastFrameProxyTime,demuxerTime:0,videoTime:0,audioTime:0,clockTime:actualPerFrameTime,late:stoppedForLateFrame||data.dropped,dropped:data.dropped};if(codec){timing.demuxerTime=codec.demuxerCpuTime-lastFrameDemuxerCpuTime;timing.videoTime+=currentVideoCpuTime-lastFrameVideoCpuTime;timing.audioTime+=codec.audioCpuTime-lastFrameAudioCpuTime}timing.cpuTime+=timing.demuxerTime;
lastFrameDecodeTime=0;lastFrameTimestamp=newFrameTimestamp;if(codec){lastFrameVideoCpuTime=currentVideoCpuTime;lastFrameAudioCpuTime=codec.audioCpuTime;lastFrameDemuxerCpuTime=codec.demuxerCpuTime}else{lastFrameVideoCpuTime=0;lastFrameAudioCpuTime=0;lastFrameDemuxerCpuTime=0}lastFrameDrawingTime=drawingTime;lastFrameBufferTime=bufferTime;lastFrameProxyTime=proxyTime;function n(x){return Math.round(x*10)/10}log("drew frame "+data.frameEndTimestamp+": "+"clock time "+n(wallClockTime)+" (jitter "+n(jitter)+
") "+"cpu: "+n(timing.cpuTime)+" (mux: "+n(timing.demuxerTime)+" buf: "+n(timing.bufferTime)+" draw: "+n(timing.drawingTime)+" proxy: "+n(timing.proxyTime)+") "+"vid: "+n(timing.videoTime)+" aud: "+n(timing.audioTime));fireEventAsync("framecallback",timing);if(!lastTimeUpdate||newFrameTimestamp-lastTimeUpdate>=timeUpdateInterval){lastTimeUpdate=newFrameTimestamp;fireEventAsync("timeupdate")}}var seekTargetTime=0,seekTargetKeypoint=0,bisectTargetTime=0,seekMode,lastSeekPosition,lastFrameSkipped,seekBisector,
didSeek;var SeekMode={EXACT:"exact",FAST:"fast"};function Cancel(msg){Error.call(this,msg)}Cancel.prototype=Object.create(Error);function seekStream(offset){if(stream.seeking)seekCancel.cancel(new Cancel("cancel for new seek"));if(stream.buffering)readCancel.cancel(new Cancel("cancel for new seek"));streamEnded=false;dataEnded=false;ended=false;stream.seek(offset,seekCancel).then(function(){readBytesAndWait()})["catch"](onStreamError)}function startBisection(targetTime){var endPoint=Math.max(0,stream.length-
65536);bisectTargetTime=targetTime;seekBisector=new Bisector({start:0,end:endPoint,process:function(start,end,position){if(position==lastSeekPosition)return false;else{lastSeekPosition=position;lastFrameSkipped=false;codec.flush(function(){seekStream(position)});return true}}});seekBisector.start()}function seek(toTime,mode){log("requested seek to "+toTime+", mode "+mode);if(self.readyState==self.HAVE_NOTHING){log("not yet loaded; saving seek position for later");initialSeekTime=toTime;return}if(stream&&
!stream.seekable){console.log(stream);throw new Error("Cannot seek a non-seekable stream");}function prepForSeek(callback){if(stream&&stream.buffering)readCancel.cancel(new Cancel("cancel for new seek"));if(stream&&stream.seeking)seekCancel.cancel(new Cancel("cancel for new seek"));actionQueue.splice(0,actionQueue.length);stopPlayback();prebufferingAudio=false;stoppedForLateFrame=false;if(audioFeeder)audioFeeder.flush();state=State.SEEKING;seekTargetTime=toTime;seekMode=mode;if(codec)codec.flush(callback);
else callback()}prepForSeek(function(){if(isProcessing());else pingProcessing(0)});actionQueue.push(function(){prepForSeek(function(){doSeek(toTime)})})}function doSeek(toTime){streamEnded=false;dataEnded=false;ended=false;state=State.SEEKING;seekTargetTime=toTime;seekTargetKeypoint=-1;lastFrameSkipped=false;lastSeekPosition=-1;decodedFrames=[];pendingFrames=[];pendingFrame=0;pendingAudio=0;didSeek=false;codec.seekToKeypoint(toTime,function(seeking){if(seeking){seekState=SeekState.LINEAR_TO_TARGET;
fireEventAsync("seeking");if(didSeek)return;else{pingProcessing();return}}codec.getKeypointOffset(toTime,function(offset){if(offset>0){seekState=SeekState.LINEAR_TO_TARGET;seekStream(offset)}else{seekState=SeekState.BISECT_TO_TARGET;startBisection(seekTargetTime)}fireEventAsync("seeking")})})}function continueSeekedPlayback(){seekState=SeekState.NOT_SEEKING;state=State.READY;frameEndTimestamp=codec.frameTimestamp;audioEndTimestamp=codec.audioTimestamp;if(codec.hasAudio)seekTargetTime=codec.audioTimestamp;
else seekTargetTime=codec.frameTimestamp;initialPlaybackOffset=seekTargetTime;function finishedSeeking(){lastTimeUpdate=seekTargetTime;fireEventAsync("timeupdate");fireEventAsync("seeked");if(isProcessing());else pingProcessing()}if(codec.hasVideo&&codec.frameReady){codec.decodeFrame(function(ok){if(ok){if(thumbnail){self.removeChild(thumbnail);thumbnail=null}frameSink.drawFrame(codec.frameBuffer)}finishedSeeking()});return}else finishedSeeking()}function doProcessLinearSeeking(){var frameDuration;
if(codec.hasVideo)frameDuration=targetPerFrameTime/1E3;else frameDuration=1/256;if(codec.hasVideo)if(pendingFrame)return;else if(!codec.frameReady){codec.process(function(more){if(more)pingProcessing();else if(streamEnded){log("stream ended during linear seeking on video");dataEnded=true;continueSeekedPlayback()}else readBytesAndWait()});return}else if(seekMode===SeekMode.FAST&&codec.keyframeTimestamp==codec.frameTimestamp){continueSeekedPlayback();return}else if(codec.frameTimestamp+frameDuration<
seekTargetTime){codec.decodeFrame(function(){pingProcessing()});return}else if(codec.hasAudio);else{continueSeekedPlayback();return}if(codec.hasAudio){if(pendingAudio)return;if(!codec.audioReady){codec.process(function(more){if(more)pingProcessing();else if(streamEnded){log("stream ended during linear seeking on audio");dataEnded=true;continueSeekedPlayback()}else readBytesAndWait()});return}else if(codec.audioTimestamp+frameDuration<seekTargetTime){codec.decodeAudio(function(){pingProcessing()});
return}else{continueSeekedPlayback();return}}}function doProcessBisectionSeek(){var frameDuration,timestamp;if(codec.hasVideo){timestamp=codec.frameTimestamp;frameDuration=targetPerFrameTime/1E3}else if(codec.hasAudio){timestamp=codec.audioTimestamp;frameDuration=1/256}else throw new Error("Invalid seek state; no audio or video track available");if(timestamp<0)codec.process(function(more){if(more)pingProcessing();else if(streamEnded){log("stream ended during bisection seek");if(seekBisector.right());
else{log("failed going back");throw new Error("not sure what to do");}}else readBytesAndWait()});else if(timestamp-frameDuration/2>bisectTargetTime)if(seekBisector.left());else{log("close enough (left)");seekTargetTime=timestamp;continueSeekedPlayback()}else if(timestamp+frameDuration/2<bisectTargetTime)if(seekBisector.right());else{log("close enough (right)");seekState=SeekState.LINEAR_TO_TARGET;pingProcessing()}else if(seekState==SeekState.BISECT_TO_TARGET&&(codec.hasVideo&&codec.keyframeTimestamp<
codec.frameTimestamp)){log("finding the keypoint now");seekState=SeekState.BISECT_TO_KEYPOINT;startBisection(codec.keyframeTimestamp)}else{log("straight seeking now");seekState=SeekState.LINEAR_TO_TARGET;pingProcessing()}}function setupVideo(){if(videoInfo.fps>0)targetPerFrameTime=1E3/videoInfo.fps;else targetPerFrameTime=16.667;canvas.width=videoInfo.displayWidth;canvas.height=videoInfo.displayHeight;OGVPlayer.styleManager.appendRule("."+instanceId,{width:videoInfo.displayWidth+"px",height:videoInfo.displayHeight+
"px"});OGVPlayer.updatePositionOnResize();frameSink=YUVCanvas.attach(canvas,canvasOptions)}var depth=0,needProcessing=false,pendingFrame=0,pendingAudio=0,framePipelineDepth=3,audioPipelineDepth=4;function doProcessing(){if(didSeek)didSeek=false;nextProcessingTimer=null;if(isProcessing());if(depth>0)throw new Error("REENTRANCY FAIL: doProcessing recursing unexpectedly");var iters=0;do{needProcessing=false;depth++;doProcessingLoop();depth--;if(needProcessing&&isProcessing())throw new Error("REENTRANCY FAIL: waiting on input or codec but asked to keep processing");
if(++iters>500){log("stuck in processing loop; breaking with timer");needProcessing=0;pingProcessing(0)}}while(needProcessing)}function doProcessingLoop(){if(actionQueue.length){var action=actionQueue.shift();action()}else if(state==State.INITIAL)if(codec.loadedMetadata){if(!codec.hasVideo&&!codec.hasAudio)throw new Error("No audio or video found, something is wrong");if(codec.hasAudio)audioInfo=codec.audioFormat;if(codec.hasVideo){videoInfo=codec.videoFormat;setupVideo()}if(!isNaN(codec.duration))duration=
codec.duration;if(duration===null)if(stream.seekable){state=State.SEEKING_END;lastSeenTimestamp=-1;codec.flush(function(){seekStream(Math.max(0,stream.length-65536*2))})}else{state=State.LOADED;pingProcessing()}else{state=State.LOADED;pingProcessing()}}else codec.process(function processInitial(more){if(more)pingProcessing();else if(streamEnded)throw new Error("end of file before headers found");else{log("reading more cause we are out of data");readBytesAndWait()}});else if(state==State.SEEKING_END)if(codec.frameReady){log("saw frame with "+
codec.frameTimestamp);lastSeenTimestamp=Math.max(lastSeenTimestamp,codec.frameTimestamp);codec.discardFrame(function(){pingProcessing()})}else if(codec.audioReady){log("saw audio with "+codec.audioTimestamp);lastSeenTimestamp=Math.max(lastSeenTimestamp,codec.audioTimestamp);codec.discardAudio(function(){pingProcessing()})}else codec.process(function processSeekingEnd(more){if(more)pingProcessing();else if(!stream.eof)readBytesAndWait();else{log("seek-duration: we are at the end: "+lastSeenTimestamp);
if(lastSeenTimestamp>0)duration=lastSeenTimestamp;state=State.LOADED;codec.flush(function(){streamEnded=false;dataEnded=false;seekStream(0)})}});else if(state==State.LOADED){state=State.PRELOAD;fireEventAsync("loadedmetadata");fireEventAsync("durationchange");if(codec.hasVideo)fireEventAsync("resize");pingProcessing(0)}else if(state==State.PRELOAD)if((codec.frameReady||!codec.hasVideo)&&(codec.audioReady||!codec.hasAudio)){state=State.READY;fireEventAsync("loadeddata");pingProcessing()}else codec.process(function doProcessPreload(more){if(more)pingProcessing();
else if(streamEnded)ended=true;else readBytesAndWait()});else if(state==State.READY){log("initial seek to "+initialSeekTime);if(initialSeekTime>0){var target=initialSeekTime;initialSeekTime=0;log("initial seek to "+target);doSeek(target)}else if(paused)log("paused while in ready");else{var finishStartPlaying=function(){log("finishStartPlaying");state=State.PLAYING;lastFrameTimestamp=getTimestamp();if(codec.hasAudio&&audioFeeder)prebufferingAudio=true;else startPlayback();pingProcessing(0);fireEventAsync("play");
fireEventAsync("playing")};if(codec.hasAudio&&!audioFeeder&&!muted){initAudioFeeder();audioFeeder.waitUntilReady(finishStartPlaying)}else finishStartPlaying()}}else if(state==State.SEEKING)if(seekState==SeekState.NOT_SEEKING)throw new Error("seeking in invalid state (not seeking?)");else if(seekState==SeekState.BISECT_TO_TARGET)doProcessBisectionSeek();else if(seekState==SeekState.BISECT_TO_KEYPOINT)doProcessBisectionSeek();else if(seekState==SeekState.LINEAR_TO_TARGET)doProcessLinearSeeking();else throw new Error("Invalid seek state "+
seekState);else if(state==State.PLAYING){var doProcessPlayDemux=function(){var wasFrameReady=codec.frameReady,wasAudioReady=codec.audioReady;codec.process(function doProcessPlayDemuxHandler(more){if(codec.frameReady&&!wasFrameReady||codec.audioReady&&!wasAudioReady){log("demuxer has packets");pingProcessing()}else if(more){log("demuxer processing to find more packets");pingProcessing()}else{log("demuxer ran out of data");if(!streamEnded){log("demuxer loading more data");readBytesAndWait()}else{log("demuxer reached end of data stream");
dataEnded=true;pingProcessing()}}})};var doProcessPlay=function(){if(paused)log("paused during playback; stopping loop");else if((!codec.hasAudio||codec.audioReady||pendingAudio||dataEnded)&&(!codec.hasVideo||codec.frameReady||pendingFrame||decodedFrames.length||dataEnded)){var audioState=null,playbackPosition=0,readyForAudioDecode,audioEnded=false,readyForFrameDraw,frameDelay=0,readyForFrameDecode,timerMinimum=4,fudgeDelta=timerMinimum;if(codec.hasAudio&&audioFeeder){audioState=audioFeeder.getPlaybackState();
playbackPosition=getPlaybackTime(audioState);audioEnded=dataEnded&&audioFeeder.durationBuffered==0;if(prebufferingAudio&&(audioFeeder.durationBuffered>=audioFeeder.bufferThreshold*2||dataEnded)){log("prebuffering audio done; buffered to "+audioFeeder.durationBuffered);startPlayback(playbackPosition);prebufferingAudio=false}if(audioState.dropped!=droppedAudio)log("dropped "+(audioState.dropped-droppedAudio));if(audioState.delayed!=delayedAudio)log("delayed "+(audioState.delayed-delayedAudio));droppedAudio=
audioState.dropped;delayedAudio=audioState.delayed;readyForAudioDecode=audioFeeder.durationBuffered<=audioFeeder.bufferThreshold*2;if(!readyForAudioDecode);else if(!codec.audioReady)readyForAudioDecode=false;else if(pendingAudio>=audioPipelineDepth){log("audio decode disabled: "+pendingAudio+" packets in flight");readyForAudioDecode=false}}else{playbackPosition=getPlaybackTime();readyForAudioDecode=codec.audioReady&&audioEndTimestamp<playbackPosition}if(codec.hasVideo){readyForFrameDraw=decodedFrames.length>
0;readyForFrameDecode=pendingFrame+decodedFrames.length<framePipelineDepth&&codec.frameReady;if(readyForFrameDraw){frameDelay=(decodedFrames[0].frameEndTimestamp-playbackPosition)*1E3;actualPerFrameTime=targetPerFrameTime-frameDelay}var audioSyncThreshold=targetPerFrameTime;if(prebufferingAudio){if(readyForFrameDecode)log("decoding a frame during prebuffering");readyForFrameDraw=false}else if(readyForFrameDraw&&dataEnded&&audioEnded)log("audio timeline ended? ready to draw frame");else if(readyForFrameDraw&&
-frameDelay>=audioSyncThreshold)if(options.sync=="delay-audio"){if(!stoppedForLateFrame){log("late frame at "+playbackPosition+": "+-frameDelay+" expected "+audioSyncThreshold);lateFrames++;if(decodedFrames.length>1){log("late frame has a neighbor; skipping to next frame");var frame=decodedFrames.shift();frameDelay=(frame.frameEndTimestamp-playbackPosition)*1E3;actualPerFrameTime=targetPerFrameTime-frameDelay;framesProcessed++;doFrameComplete({frameEndTimestamp:frame.frameEndTimestamp,dropped:true})}else{stopPlayback();
stoppedForLateFrame=true}}}else{if(options.sync=="skip-frames"){var skipPast=-1;for(var i=0;i<decodedFrames.length-1;i++)if(decodedFrames[i].frameEndTimestamp<playbackPosition)skipPast=i-1;if(skipPast>=0)while(skipPast-- >=0){lateFrames++;var frame=decodedFrames.shift();log("skipping already-decoded late frame at "+frame.frameEndTimestamp);frameDelay=(frame.frameEndTimestamp-playbackPosition)*1E3;frameEndTimestamp=frame.frameEndTimestamp;actualPerFrameTime=targetPerFrameTime-frameDelay;framesProcessed++;
frame.dropped=true;doFrameComplete()}var nextKeyframe=codec.nextKeyframeTimestamp;var videoSyncPadding=targetPerFrameTime/1E3*(framePipelineDepth+pendingFrame);var timeToResync=nextKeyframe-videoSyncPadding;if(nextKeyframe>=0&&nextKeyframe!=codec.frameTimestamp&&playbackPosition>=timeToResync){log("skipping late frame at "+decodedFrames[0].frameEndTimestamp+" vs "+playbackPosition+", expect to see keyframe at "+nextKeyframe);for(var i=0;i<decodedFrames.length;i++){var frame=decodedFrames[i];lateFrames++;
framesProcessed++;frameEndTimestamp=frame.frameEndTimestamp;frameDelay=(frame.frameEndTimestamp-playbackPosition)*1E3;actualPerFrameTime=targetPerFrameTime-frameDelay;frame.dropped=true;doFrameComplete(frame)}decodedFrames=[];for(var i=0;i<pendingFrames.length;i++){var frame=pendingFrames[i];lateFrames++;framesProcessed++;frameEndTimestamp=frame.frameEndTimestamp;frameDelay=(frame.frameEndTimestamp-playbackPosition)*1E3;actualPerFrameTime=targetPerFrameTime-frameDelay;frame.dropped=true;doFrameComplete(frame)}pendingFrames=
[];pendingFrame=0;while(codec.frameReady&&codec.frameTimestamp<nextKeyframe){var frame={frameEndTimestamp:codec.frameTimestamp,dropped:true};frameDelay=(frame.frameEndTimestamp-playbackPosition)*1E3;actualPerFrameTime=targetPerFrameTime-frameDelay;lateFrames++;codec.discardFrame(function(){});framesProcessed++;doFrameComplete(frame)}if(isProcessing());else pingProcessing();return}}}else if(readyForFrameDraw&&stoppedForLateFrame&&!readyForFrameDecode&&!readyForAudioDecode&&frameDelay>fudgeDelta){log("late frame recovery reached "+
frameDelay);startPlayback(playbackPosition);stoppedForLateFrame=false;readyForFrameDraw=false}else if(readyForFrameDraw&&stoppedForLateFrame);else if(readyForFrameDraw&&frameDelay<=fudgeDelta);else readyForFrameDraw=false}if(readyForFrameDecode){log("play loop: ready to decode frame; thread depth: "+pendingFrame+", have buffered: "+decodedFrames.length);if(videoInfo.fps==0&&codec.frameTimestamp-frameEndTimestamp>0)targetPerFrameTime=(codec.frameTimestamp-frameEndTimestamp)*1E3;totalFrameTime+=targetPerFrameTime;
totalFrameCount++;var nextFrameEndTimestamp=frameEndTimestamp=codec.frameTimestamp;pendingFrame++;pendingFrames.push({frameEndTimestamp:nextFrameEndTimestamp});var currentPendingFrames=pendingFrames;var wasAsync=false;var frameDecodeTime=time(function(){codec.decodeFrame(function processingDecodeFrame(ok){if(currentPendingFrames!==pendingFrames){log("play loop callback after flush, discarding");return}log("play loop callback: decoded frame");pendingFrame--;pendingFrames.shift();if(ok)decodedFrames.push({yCbCrBuffer:codec.frameBuffer,
videoCpuTime:codec.videoCpuTime,frameEndTimestamp:nextFrameEndTimestamp});else log("Bad video packet or something");codec.process(function(){if(isProcessing());else pingProcessing(wasAsync?undefined:0)})})});if(pendingFrame){wasAsync=true;proxyTime+=frameDecodeTime;pingProcessing()}}else if(readyForAudioDecode){log("play loop: ready for audio; depth: "+pendingAudio);pendingAudio++;var nextAudioEndTimestamp=codec.audioTimestamp;var audioDecodeTime=time(function(){codec.decodeAudio(function processingDecodeAudio(ok){pendingAudio--;
log("play loop callback: decoded audio");audioEndTimestamp=nextAudioEndTimestamp;if(ok){var buffer=codec.audioBuffer;if(buffer){bufferTime+=time(function(){if(audioFeeder)audioFeeder.bufferData(buffer)});if(!codec.hasVideo){framesProcessed++;var frame={frameEndTimestamp:audioEndTimestamp};doFrameComplete(frame)}}}if(isProcessing());else pingProcessing()})});if(pendingAudio){proxyTime+=audioDecodeTime;if(codec.audioReady)pingProcessing();else doProcessPlayDemux()}}else if(readyForFrameDraw){log("play loop: ready to draw frame");
if(nextFrameTimer){clearTimeout(nextFrameTimer);nextFrameTimer=null}if(thumbnail){self.removeChild(thumbnail);thumbnail=null}var frame=decodedFrames.shift();currentVideoCpuTime=frame.videoCpuTime;drawingTime+=time(function(){frameSink.drawFrame(frame.yCbCrBuffer)});framesProcessed++;framesPlayed++;doFrameComplete(frame);pingProcessing()}else if(decodedFrames.length&&!nextFrameTimer&&!prebufferingAudio){var targetTimer=frameDelay;log("play loop: setting a timer for drawing "+targetTimer);nextFrameTimer=
setTimeout(function(){nextFrameTimer=null;pingProcessing()},targetTimer)}else if(dataEnded&&!(pendingAudio||pendingFrame||decodedFrames.length)){log("play loop: playback reached end of data "+[pendingAudio,pendingFrame,decodedFrames.length]);var finalDelay=0;if(codec.hasAudio&&audioFeeder)finalDelay=audioFeeder.durationBuffered*1E3;if(finalDelay>0){log("play loop: ending pending "+finalDelay+" ms");pingProcessing(Math.max(0,finalDelay))}else{log("play loop: ENDING NOW: playback time "+getPlaybackTime()+
"; frameEndTimestamp: "+frameEndTimestamp);stopPlayback();stoppedForLateFrame=false;prebufferingAudio=false;initialPlaybackOffset=Math.max(audioEndTimestamp,frameEndTimestamp);ended=true;paused=true;fireEventAsync("pause");fireEventAsync("ended")}}else log("play loop: waiting on async/timers")}else{log("play loop: demuxing");doProcessPlayDemux()}};doProcessPlay()}else if(state==State.ERROR)console.log("Reached error state. Sorry bout that.");else throw new Error("Unexpected OGVPlayer state "+state);
}function isProcessing(){return stream&&(stream.buffering||stream.seeking)||codec&&codec.processing}function readBytesAndWait(){if(stream.buffering||stream.seeking){log("readBytesAndWait during i/o");return}var bufferSize=32768;stream.read(bufferSize,readCancel).then(function(data){log("got input "+[data.byteLength]);if(data.byteLength)actionQueue.push(function doReceiveInput(){codec.receiveInput(data,function(){pingProcessing()})});if(stream.eof){log("stream is at end!");streamEnded=true}if(isProcessing());
else pingProcessing()})["catch"](onStreamError)}function onStreamError(err){if(err instanceof Cancel)log("i/o promise canceled; ignoring");else{log("i/o error: "+err);mediaError=new OGVMediaError(OGVMediaError.MEDIA_ERR_NETWORK,""+err);state=State.ERROR;stopPlayback()}}function pingProcessing(delay){if(delay===undefined)delay=-1;if(stream&&stream.waiting){log("waiting on input");return}if(nextProcessingTimer){log("canceling old processing timer");clearTimeout(nextProcessingTimer);nextProcessingTimer=
null}var fudge=-1/256;if(delay>fudge)nextProcessingTimer=setTimeout(function(){pingProcessing()},delay);else if(depth)needProcessing=true;else doProcessing()}var videoInfo,audioInfo;function startProcessingVideo(){if(started||codec)return;framesProcessed=0;bufferTime=0;drawingTime=0;proxyTime=0;started=true;ended=false;codec=new codecClass(codecOptions);lastVideoCpuTime=0;lastAudioCpuTime=0;lastDemuxerCpuTime=0;lastBufferTime=0;lastDrawingTime=0;lastProxyTime=0;lastFrameVideoCpuTime=0;lastFrameAudioCpuTime=
0;lastFrameDemuxerCpuTime=0;lastFrameBufferTime=0;lastFrameProxyTime=0;lastFrameDrawingTime=0;currentVideoCpuTime=0;codec.onseek=function(offset){didSeek=true;if(stream)seekStream(offset)};codec.init(function(){readBytesAndWait()})}function loadCodec(callback){if(enableWebM&&currentSrc.match(/\.webm$/i))codecOptions.type="video/webm";else codecOptions.type="video/ogg";codecClass=OGVWrapperCodec;callback()}self.load=function(){prepForLoad()};function prepForLoad(preload){stopVideo();function doLoad(){stream=
new StreamFile({url:self.src,cacheSize:16*1024*1024});stream.load().then(function(){loading=false;currentSrc=self.src;byteLength=stream.seekable?stream.length:0;var durationHeader=stream.headers["x-content-duration"];if(typeof durationHeader==="string")duration=parseFloat(durationHeader);loadCodec(startProcessingVideo)})["catch"](onStreamError)}currentSrc="";loading=true;actionQueue.push(function(){if(preload&&self.preload==="none")loading=false;else doLoad()});pingProcessing(0)}self.canPlayType=
function(contentType){var type=new OGVMediaType(contentType);if(type.minor==="ogg"&&(type.major==="audio"||type.major==="video"||type.major==="application"))if(type.codecs){var supported=["vorbis","opus","theora"],knownCodecs=0,unknownCodecs=0;type.codecs.forEach(function(codec){if(supported.indexOf(codec)>=0)knownCodecs++;else unknownCodecs++});if(knownCodecs===0)return"";else if(unknownCodecs>0)return"";return"probably"}else return"maybe";else return""};self.play=function(){if(!muted&&!audioOptions.audioContext)OGVPlayer.initSharedAudioContext();
if(paused){startedPlaybackInDocument=document.body.contains(self);paused=false;if(state==State.SEEKING);else if(started&&codec&&codec.loadedMetadata){if(ended&&stream&&byteLength){log(".play() starting over after end");seek(0)}else log(".play() while already started");state=State.READY;if(isProcessing());else pingProcessing()}else if(loading)log(".play() while loading");else{log(".play() before started");if(!stream)self.load()}}};self.getPlaybackStats=function(){return{targetPerFrameTime:targetPerFrameTime,
framesProcessed:framesProcessed,playTime:playTime,demuxingTime:codec?codec.demuxerCpuTime-lastDemuxerCpuTime:0,videoDecodingTime:codec?codec.videoCpuTime-lastVideoCpuTime:0,audioDecodingTime:codec?codec.audioCpuTime-lastAudioCpuTime:0,bufferTime:bufferTime-lastBufferTime,drawingTime:drawingTime-lastDrawingTime,proxyTime:proxyTime-lastProxyTime,droppedAudio:droppedAudio,delayedAudio:delayedAudio,jitter:totalJitter/framesProcessed,lateFrames:lateFrames}};self.resetPlaybackStats=function(){framesProcessed=
0;playTime=0;if(codec){lastDemuxerCpuTime=codec.demuxerCpuTime;lastVideoCpuTime=codec.videoCpuTime;lastAudioCpuTime=codec.audioCpuTime}lastBufferTime=bufferTime;lastDrawingTime=drawingTime;lastProxyTime=proxyTime;totalJitter=0;totalFrameTime=0;totalFrameCount=0};self.getVideoFrameSink=function(){return frameSink};self.getCanvas=function(){return canvas};self.pause=function(){if(!paused){clearTimeout(nextProcessingTimer);nextProcessingTimer=null;stopPlayback();prebufferingAudio=false;stoppedForLateFrame=
false;paused=true;fireEvent("pause")}};self.stop=function(){stopVideo();paused=true};self.fastSeek=function(seekToTime){seek(+seekToTime,SeekMode.FAST)};Object.defineProperty(self,"src",{get:function getSrc(){return self.getAttribute("src")||""},set:function setSrc(val){self.setAttribute("src",val);loading=false;prepForLoad("interactive")}});Object.defineProperty(self,"buffered",{get:function getBuffered(){var ranges;if(stream&&byteLength&&duration)ranges=stream.getBufferedRanges().map(function(range){return range.map(function(offset){return offset/
stream.length*duration})});else ranges=[[0,0]];return new OGVTimeRanges(ranges)}});Object.defineProperty(self,"seekable",{get:function getSeekable(){if(self.duration<Infinity&&stream&&stream.seekable&&codec&&codec.seekable)return new OGVTimeRanges([[0,duration]]);else return new OGVTimeRanges([])}});Object.defineProperty(self,"currentTime",{get:function getCurrentTime(){if(state==State.SEEKING)return seekTargetTime;else if(codec)if(state==State.PLAYING&&!paused)return getPlaybackTime();else return initialPlaybackOffset;
else return initialSeekTime},set:function setCurrentTime(val){seek(val,SeekMode.EXACT)}});Object.defineProperty(self,"duration",{get:function getDuration(){if(codec&&codec.loadedMetadata)if(duration!==null)return duration;else return Infinity;else return NaN}});Object.defineProperty(self,"paused",{get:function getPaused(){return paused}});Object.defineProperty(self,"ended",{get:function getEnded(){return ended}});Object.defineProperty(self,"seeking",{get:function getSeeking(){return state==State.SEEKING}});
Object.defineProperty(self,"muted",{get:function getMuted(){return muted},set:function setMuted(val){muted=val;if(audioFeeder)audioFeeder.muted=muted;else if(started&&!muted&&codec&&codec.hasAudio){log("unmuting: switching from timer to audio clock");initAudioFeeder();startPlayback(audioEndTimestamp)}fireEventAsync("volumechange")}});Object.defineProperty(self,"poster",{get:function getPoster(){return poster},set:function setPoster(val){poster=val;if(!started){if(thumbnail)self.removeChild(thumbnail);
thumbnail=new Image;thumbnail.src=poster;thumbnail.className="ogvjs-poster";thumbnail.style.position="absolute";thumbnail.style.top="0";thumbnail.style.left="0";thumbnail.style.width="100%";thumbnail.style.height="100%";thumbnail.style.objectFit="contain";thumbnail.style.visibility="hidden";thumbnail.addEventListener("load",function(){if(thumbnail===this){OGVPlayer.styleManager.appendRule("."+instanceId,{width:thumbnail.naturalWidth+"px",height:thumbnail.naturalHeight+"px"});OGVPlayer.updatePositionOnResize();
thumbnail.style.visibility="visible"}});self.appendChild(thumbnail)}}});Object.defineProperty(self,"videoWidth",{get:function getVideoWidth(){if(videoInfo)return videoInfo.displayWidth;else return 0}});Object.defineProperty(self,"videoHeight",{get:function getVideoHeight(){if(videoInfo)return videoInfo.displayHeight;else return 0}});Object.defineProperty(self,"ogvjsVideoFrameRate",{get:function getOgvJsVideoFrameRate(){if(videoInfo)if(videoInfo.fps==0)return totalFrameCount/(totalFrameTime/1E3);else return videoInfo.fps;
else return 0}});Object.defineProperty(self,"ogvjsAudioChannels",{get:function getOgvJsAudioChannels(){if(audioInfo)return audioInfo.channels;else return 0}});Object.defineProperty(self,"ogvjsAudioSampleRate",{get:function getOgvJsAudioChannels(){if(audioInfo)return audioInfo.rate;else return 0}});var width=0,height=0;Object.defineProperty(self,"width",{get:function getWidth(){return width},set:function setWidth(val){width=parseInt(val,10);self.style.width=width+"px";OGVPlayer.updatePositionOnResize()}});
Object.defineProperty(self,"height",{get:function getHeight(){return height},set:function setHeight(val){height=parseInt(val,10);self.style.height=height+"px";OGVPlayer.updatePositionOnResize()}});Object.defineProperty(self,"autoplay",{get:function getAutoplay(){return false},set:function setAutoplay(val){}});Object.defineProperty(self,"controls",{get:function getControls(){return false},set:function setControls(val){}});Object.defineProperty(self,"loop",{get:function getLoop(){return false},set:function setLoop(val){}});
Object.defineProperty(self,"crossOrigin",{get:function getCrossOrigin(){return null},set:function setCrossOrigin(val){}});Object.defineProperty(self,"currentSrc",{get:function getCurrentSrc(){return currentSrc}});Object.defineProperty(self,"defaultMuted",{get:function getDefaultMuted(){return false}});Object.defineProperty(self,"defaultPlaybackRate",{get:function getDefaultPlaybackRate(){return 1}});Object.defineProperty(self,"error",{get:function getError(){if(state===State.ERROR)if(mediaError)return mediaError;
else return new OGVMediaError("unknown error occurred in media procesing");else return null}});Object.defineProperty(self,"preload",{get:function getPreload(){return self.getAttribute("preload")||""},set:function setPreload(val){self.setAttribute("preload",val)}});Object.defineProperty(self,"readyState",{get:function getReadyState(){if(stream&&codec&&codec.loadedMetadata)return OGVPlayer.HAVE_ENOUGH_DATA;else return OGVPlayer.HAVE_NOTHING}});Object.defineProperty(self,"networkState",{get:function getNetworkState(){if(stream)if(stream.waiting)return OGVPlayer.NETWORK_LOADING;
else return OGVPlayer.NETWORK_IDLE;else if(self.readyState==OGVPlayer.HAVE_NOTHING)return OGVPlayer.NETWORK_EMPTY;else return OGVPlayer.NETWORK_NO_SOURCE}});Object.defineProperty(self,"playbackRate",{get:function getPlaybackRate(){return 1},set:function setPlaybackRate(val){}});Object.defineProperty(self,"played",{get:function getPlayed(){return new OGVTimeRanges([[0,self.currentTime]])}});var _volume=1;Object.defineProperty(self,"volume",{get:function getVolume(){return _volume},set:function setVolume(val){_volume=
+val;if(audioFeeder)audioFeeder.volume=_volume;fireEventAsync("volumechange")}});self.onframecallback=null;self.onloadstate=null;self.onprogress=null;self.onsuspend=null;self.onabort=null;self.onemptied=null;self.onstalled=null;self.onloadedmetadata=null;self.onloadeddata=null;self.oncanplay=null;self.oncanplaythrough=null;self.onplaying=null;self.onwaiting=null;self.onseeking=null;self.onseeked=null;self.onended=null;self.ondurationchange=null;self.ontimeupdate=null;self.onplay=null;self.onpause=
null;self.onratechange=null;self.onresize=null;self.onvolumechange=null;return self};OGVPlayer.initSharedAudioContext=function(){AudioFeeder.initSharedAudioContext()};var constants={NETWORK_EMPTY:0,NETWORK_IDLE:1,NETWORK_LOADING:2,NETWORK_NO_SOURCE:3,HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4};extend(OGVPlayer,constants);OGVPlayer.instanceCount=0;function StyleManager(){var self=this;var el=document.createElement("style");el.type="text/css";el.textContent=
"ogvjs { "+"display: inline-block; "+"position: relative; "+"-webkit-user-select: none; "+"-webkit-tap-highlight-color: rgba(0,0,0,0); ";"}";document.head.appendChild(el);var sheet=el.sheet;self.appendRule=function(selector,defs){var bits=[];for(var prop in defs)if(defs.hasOwnProperty(prop))bits.push(prop+":"+defs[prop]);var rule=selector+"{"+bits.join(";")+"}";sheet.insertRule(rule,sheet.cssRules.length-1)}}OGVPlayer.styleManager=new StyleManager;OGVPlayer.supportsObjectFit=typeof document.createElement("div").style.objectFit===
"string";if(OGVPlayer.supportsObjectFit&&navigator.userAgent.match(/iPhone|iPad|iPod Touch/))OGVPlayer.supportsObjectFit=false;if(OGVPlayer.supportsObjectFit)OGVPlayer.updatePositionOnResize=function(){};else{OGVPlayer.updatePositionOnResize=function(){function fixup(el,width,height){var container=el.offsetParent||el.parentNode,containerAspect=container.offsetWidth/container.offsetHeight,intrinsicAspect=width/height;if(intrinsicAspect>containerAspect){var vsize=container.offsetWidth/intrinsicAspect,
vpad=(container.offsetHeight-vsize)/2;el.style.width="100%";el.style.height=vsize+"px";el.style.marginLeft=0;el.style.marginRight=0;el.style.marginTop=vpad+"px";el.style.marginBottom=vpad+"px"}else{var hsize=container.offsetHeight*intrinsicAspect,hpad=(container.offsetWidth-hsize)/2;el.style.width=hsize+"px";el.style.height="100%";el.style.marginLeft=hpad+"px";el.style.marginRight=hpad+"px";el.style.marginTop=0;el.style.marginBottom=0}}function queryOver(selector,callback){var nodeList=document.querySelectorAll(selector),
nodeArray=Array.prototype.slice.call(nodeList);nodeArray.forEach(callback)}queryOver("ogvjs > canvas",function(canvas){fixup(canvas,canvas.width,canvas.height)});queryOver("ogvjs > img",function(poster){fixup(poster,poster.naturalWidth,poster.naturalHeight)})};var fullResizeVideo=function(){setTimeout(OGVPlayer.updatePositionOnResize,0)};window.addEventListener("resize",OGVPlayer.updatePositionOnResize);window.addEventListener("orientationchange",OGVPlayer.updatePositionOnResize);document.addEventListener("fullscreenchange",
fullResizeVideo);document.addEventListener("mozfullscreenchange",fullResizeVideo);document.addEventListener("webkitfullscreenchange",fullResizeVideo);document.addEventListener("MSFullscreenChange",fullResizeVideo)}module.exports=OGVPlayer},function(module,exports,__webpack_require__){var require;(function(process,global){(function(global,factory){true?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.ES6Promise=factory()})(this,function(){function objectOrFunction(x){return typeof x===
"function"||typeof x==="object"&&x!==null}function isFunction(x){return typeof x==="function"}var _isArray=undefined;if(!Array.isArray)_isArray=function(x){return Object.prototype.toString.call(x)==="[object Array]"};else _isArray=Array.isArray;var isArray=_isArray;var len=0;var vertxNext=undefined;var customSchedulerFn=undefined;var asap=function asap(callback,arg){queue[len]=callback;queue[len+1]=arg;len+=2;if(len===2)if(customSchedulerFn)customSchedulerFn(flush);else scheduleFlush()};function setScheduler(scheduleFn){customSchedulerFn=
scheduleFn}function setAsap(asapFn){asap=asapFn}var browserWindow=typeof window!=="undefined"?window:undefined;var browserGlobal=browserWindow||{};var BrowserMutationObserver=browserGlobal.MutationObserver||browserGlobal.WebKitMutationObserver;var isNode=typeof self==="undefined"&&typeof process!=="undefined"&&{}.toString.call(process)==="[object process]";var isWorker=typeof Uint8ClampedArray!=="undefined"&&typeof importScripts!=="undefined"&&typeof MessageChannel!=="undefined";function useNextTick(){return function(){return process.nextTick(flush)}}
function useVertxTimer(){if(typeof vertxNext!=="undefined")return function(){vertxNext(flush)};return useSetTimeout()}function useMutationObserver(){var iterations=0;var observer=new BrowserMutationObserver(flush);var node=document.createTextNode("");observer.observe(node,{characterData:true});return function(){node.data=iterations=++iterations%2}}function useMessageChannel(){var channel=new MessageChannel;channel.port1.onmessage=flush;return function(){return channel.port2.postMessage(0)}}function useSetTimeout(){var globalSetTimeout=
setTimeout;return function(){return globalSetTimeout(flush,1)}}var queue=new Array(1E3);function flush(){for(var i=0;i<len;i+=2){var callback=queue[i];var arg=queue[i+1];callback(arg);queue[i]=undefined;queue[i+1]=undefined}len=0}function attemptVertx(){try{var r=require;var vertx=__webpack_require__(11);vertxNext=vertx.runOnLoop||vertx.runOnContext;return useVertxTimer()}catch(e){return useSetTimeout()}}var scheduleFlush=undefined;if(isNode)scheduleFlush=useNextTick();else if(BrowserMutationObserver)scheduleFlush=
useMutationObserver();else if(isWorker)scheduleFlush=useMessageChannel();else if(browserWindow===undefined&&"function"==="function")scheduleFlush=attemptVertx();else scheduleFlush=useSetTimeout();function then(onFulfillment,onRejection){var _arguments=arguments;var parent=this;var child=new this.constructor(noop);if(child[PROMISE_ID]===undefined)makePromise(child);var _state=parent._state;if(_state)(function(){var callback=_arguments[_state-1];asap(function(){return invokeCallback(_state,child,callback,
parent._result)})})();else subscribe(parent,child,onFulfillment,onRejection);return child}function resolve(object){var Constructor=this;if(object&&typeof object==="object"&&object.constructor===Constructor)return object;var promise=new Constructor(noop);_resolve(promise,object);return promise}var PROMISE_ID=Math.random().toString(36).substring(16);function noop(){}var PENDING=void 0;var FULFILLED=1;var REJECTED=2;var GET_THEN_ERROR=new ErrorObject;function selfFulfillment(){return new TypeError("You cannot resolve a promise with itself")}
function cannotReturnOwn(){return new TypeError("A promises callback cannot return that same promise.")}function getThen(promise){try{return promise.then}catch(error){GET_THEN_ERROR.error=error;return GET_THEN_ERROR}}function tryThen(then,value,fulfillmentHandler,rejectionHandler){try{then.call(value,fulfillmentHandler,rejectionHandler)}catch(e){return e}}function handleForeignThenable(promise,thenable,then){asap(function(promise){var sealed=false;var error=tryThen(then,thenable,function(value){if(sealed)return;
sealed=true;if(thenable!==value)_resolve(promise,value);else fulfill(promise,value)},function(reason){if(sealed)return;sealed=true;_reject(promise,reason)},"Settle: "+(promise._label||" unknown promise"));if(!sealed&&error){sealed=true;_reject(promise,error)}},promise)}function handleOwnThenable(promise,thenable){if(thenable._state===FULFILLED)fulfill(promise,thenable._result);else if(thenable._state===REJECTED)_reject(promise,thenable._result);else subscribe(thenable,undefined,function(value){return _resolve(promise,
value)},function(reason){return _reject(promise,reason)})}function handleMaybeThenable(promise,maybeThenable,then$$){if(maybeThenable.constructor===promise.constructor&&then$$===then&&maybeThenable.constructor.resolve===resolve)handleOwnThenable(promise,maybeThenable);else if(then$$===GET_THEN_ERROR){_reject(promise,GET_THEN_ERROR.error);GET_THEN_ERROR.error=null}else if(then$$===undefined)fulfill(promise,maybeThenable);else if(isFunction(then$$))handleForeignThenable(promise,maybeThenable,then$$);
else fulfill(promise,maybeThenable)}function _resolve(promise,value){if(promise===value)_reject(promise,selfFulfillment());else if(objectOrFunction(value))handleMaybeThenable(promise,value,getThen(value));else fulfill(promise,value)}function publishRejection(promise){if(promise._onerror)promise._onerror(promise._result);publish(promise)}function fulfill(promise,value){if(promise._state!==PENDING)return;promise._result=value;promise._state=FULFILLED;if(promise._subscribers.length!==0)asap(publish,
promise)}function _reject(promise,reason){if(promise._state!==PENDING)return;promise._state=REJECTED;promise._result=reason;asap(publishRejection,promise)}function subscribe(parent,child,onFulfillment,onRejection){var _subscribers=parent._subscribers;var length=_subscribers.length;parent._onerror=null;_subscribers[length]=child;_subscribers[length+FULFILLED]=onFulfillment;_subscribers[length+REJECTED]=onRejection;if(length===0&&parent._state)asap(publish,parent)}function publish(promise){var subscribers=
promise._subscribers;var settled=promise._state;if(subscribers.length===0)return;var child=undefined,callback=undefined,detail=promise._result;for(var i=0;i<subscribers.length;i+=3){child=subscribers[i];callback=subscribers[i+settled];if(child)invokeCallback(settled,child,callback,detail);else callback(detail)}promise._subscribers.length=0}function ErrorObject(){this.error=null}var TRY_CATCH_ERROR=new ErrorObject;function tryCatch(callback,detail){try{return callback(detail)}catch(e){TRY_CATCH_ERROR.error=
e;return TRY_CATCH_ERROR}}function invokeCallback(settled,promise,callback,detail){var hasCallback=isFunction(callback),value=undefined,error=undefined,succeeded=undefined,failed=undefined;if(hasCallback){value=tryCatch(callback,detail);if(value===TRY_CATCH_ERROR){failed=true;error=value.error;value.error=null}else succeeded=true;if(promise===value){_reject(promise,cannotReturnOwn());return}}else{value=detail;succeeded=true}if(promise._state!==PENDING);else if(hasCallback&&succeeded)_resolve(promise,
value);else if(failed)_reject(promise,error);else if(settled===FULFILLED)fulfill(promise,value);else if(settled===REJECTED)_reject(promise,value)}function initializePromise(promise,resolver){try{resolver(function resolvePromise(value){_resolve(promise,value)},function rejectPromise(reason){_reject(promise,reason)})}catch(e){_reject(promise,e)}}var id=0;function nextId(){return id++}function makePromise(promise){promise[PROMISE_ID]=id++;promise._state=undefined;promise._result=undefined;promise._subscribers=
[]}function Enumerator(Constructor,input){this._instanceConstructor=Constructor;this.promise=new Constructor(noop);if(!this.promise[PROMISE_ID])makePromise(this.promise);if(isArray(input)){this._input=input;this.length=input.length;this._remaining=input.length;this._result=new Array(this.length);if(this.length===0)fulfill(this.promise,this._result);else{this.length=this.length||0;this._enumerate();if(this._remaining===0)fulfill(this.promise,this._result)}}else _reject(this.promise,validationError())}
function validationError(){return new Error("Array Methods must be provided an Array")}Enumerator.prototype._enumerate=function(){var length=this.length;var _input=this._input;for(var i=0;this._state===PENDING&&i<length;i++)this._eachEntry(_input[i],i)};Enumerator.prototype._eachEntry=function(entry,i){var c=this._instanceConstructor;var resolve$$=c.resolve;if(resolve$$===resolve){var _then=getThen(entry);if(_then===then&&entry._state!==PENDING)this._settledAt(entry._state,i,entry._result);else if(typeof _then!==
"function"){this._remaining--;this._result[i]=entry}else if(c===Promise){var promise=new c(noop);handleMaybeThenable(promise,entry,_then);this._willSettleAt(promise,i)}else this._willSettleAt(new c(function(resolve$$){return resolve$$(entry)}),i)}else this._willSettleAt(resolve$$(entry),i)};Enumerator.prototype._settledAt=function(state,i,value){var promise=this.promise;if(promise._state===PENDING){this._remaining--;if(state===REJECTED)_reject(promise,value);else this._result[i]=value}if(this._remaining===
0)fulfill(promise,this._result)};Enumerator.prototype._willSettleAt=function(promise,i){var enumerator=this;subscribe(promise,undefined,function(value){return enumerator._settledAt(FULFILLED,i,value)},function(reason){return enumerator._settledAt(REJECTED,i,reason)})};function all(entries){return(new Enumerator(this,entries)).promise}function race(entries){var Constructor=this;if(!isArray(entries))return new Constructor(function(_,reject){return reject(new TypeError("You must pass an array to race."))});
else return new Constructor(function(resolve,reject){var length=entries.length;for(var i=0;i<length;i++)Constructor.resolve(entries[i]).then(resolve,reject)})}function reject(reason){var Constructor=this;var promise=new Constructor(noop);_reject(promise,reason);return promise}function needsResolver(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");}function needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");
}function Promise(resolver){this[PROMISE_ID]=nextId();this._result=this._state=undefined;this._subscribers=[];if(noop!==resolver){typeof resolver!=="function"&&needsResolver();this instanceof Promise?initializePromise(this,resolver):needsNew()}}Promise.all=all;Promise.race=race;Promise.resolve=resolve;Promise.reject=reject;Promise._setScheduler=setScheduler;Promise._setAsap=setAsap;Promise._asap=asap;Promise.prototype={constructor:Promise,then:then,"catch":function _catch(onRejection){return this.then(null,
onRejection)}};function polyfill(){var local=undefined;if(typeof global!=="undefined")local=global;else if(typeof self!=="undefined")local=self;else try{local=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment");}var P=local.Promise;if(P){var promiseToString=null;try{promiseToString=Object.prototype.toString.call(P.resolve())}catch(e$0){}if(promiseToString==="[object Promise]"&&!P.cast)return}local.Promise=Promise}Promise.polyfill=
polyfill;Promise.Promise=Promise;return Promise})}).call(exports,__webpack_require__(10),function(){return this}())},function(module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined");}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined");}(function(){try{if(typeof setTimeout==="function")cachedSetTimeout=setTimeout;else cachedSetTimeout=defaultSetTimout}catch(e){cachedSetTimeout=
defaultSetTimout}try{if(typeof clearTimeout==="function")cachedClearTimeout=clearTimeout;else cachedClearTimeout=defaultClearTimeout}catch(e$1){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e$2){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,
fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e$3){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||
!currentQueue)return;draining=false;if(currentQueue.length)queue=currentQueue.concat(queue);else queueIndex=-1;if(queue.length)drainQueue()}function drainQueue(){if(draining)return;var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len)if(currentQueue)currentQueue[queueIndex].run();queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-
1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args));if(queue.length===1&&!draining)runTimeout(drainQueue)};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=
noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported");};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported");};process.umask=function(){return 0}},function(module,exports){},function(module,exports,__webpack_require__){(function(){var FrameSink=__webpack_require__(13),SoftwareFrameSink=__webpack_require__(14),WebGLFrameSink=__webpack_require__(17);var YUVCanvas=
{FrameSink:FrameSink,SoftwareFrameSink:SoftwareFrameSink,WebGLFrameSink:WebGLFrameSink,attach:function(canvas,options){options=options||{};var webGL="webGL"in options?options.webGL:WebGLFrameSink.isAvailable();if(webGL)return new WebGLFrameSink(canvas,options);else return new SoftwareFrameSink(canvas,options)}};module.exports=YUVCanvas})()},function(module,exports){(function(){function FrameSink(canvas,options){throw new Error("abstract");}FrameSink.prototype.drawFrame=function(buffer){throw new Error("abstract");
};FrameSink.prototype.clear=function(){throw new Error("abstract");};module.exports=FrameSink})()},function(module,exports,__webpack_require__){(function(){var FrameSink=__webpack_require__(13),YCbCr=__webpack_require__(15);function SoftwareFrameSink(canvas){var self=this,ctx=canvas.getContext("2d"),imageData=null,resampleCanvas=null,resampleContext=null;function initImageData(width,height){imageData=ctx.createImageData(width,height);var data=imageData.data,pixelCount=width*height*4;for(var i=0;i<
pixelCount;i+=4)data[i+3]=255}function initResampleCanvas(cropWidth,cropHeight){resampleCanvas=document.createElement("canvas");resampleCanvas.width=cropWidth;resampleCanvas.height=cropHeight;resampleContext=resampleCanvas.getContext("2d")}self.drawFrame=function drawFrame(buffer){var format=buffer.format;if(canvas.width!==format.displayWidth||canvas.height!==format.displayHeight){canvas.width=format.displayWidth;canvas.height=format.displayHeight}if(imageData===null||imageData.width!=format.width||
imageData.height!=format.height)initImageData(format.width,format.height);YCbCr.convertYCbCr(buffer,imageData.data);var resample=format.cropWidth!=format.displayWidth||format.cropHeight!=format.displayHeight;var drawContext;if(resample){if(!resampleCanvas)initResampleCanvas(format.cropWidth,format.cropHeight);drawContext=resampleContext}else drawContext=ctx;drawContext.putImageData(imageData,0,0,format.cropLeft,format.cropTop,format.cropWidth,format.cropHeight);if(resample)ctx.drawImage(resampleCanvas,
0,0,format.displayWidth,format.displayHeight)};self.clear=function(){ctx.clearRect(0,0,canvas.width,canvas.height)};return self}SoftwareFrameSink.prototype=Object.create(FrameSink.prototype);module.exports=SoftwareFrameSink})()},function(module,exports,__webpack_require__){(function(){var depower=__webpack_require__(16);function convertYCbCr(buffer,output){var width=buffer.format.width,height=buffer.format.height,hdec=depower(buffer.format.width/buffer.format.chromaWidth),vdec=depower(buffer.format.height/
buffer.format.chromaHeight),bytesY=buffer.y.bytes,bytesCb=buffer.u.bytes,bytesCr=buffer.v.bytes,strideY=buffer.y.stride,strideCb=buffer.u.stride,strideCr=buffer.v.stride,outStride=4*width,YPtr=0,Y0Ptr=0,Y1Ptr=0,CbPtr=0,CrPtr=0,outPtr=0,outPtr0=0,outPtr1=0,colorCb=0,colorCr=0,multY=0,multCrR=0,multCbCrG=0,multCbB=0,x=0,y=0,xdec=0,ydec=0;if(hdec==1&&vdec==1){outPtr0=0;outPtr1=outStride;ydec=0;for(y=0;y<height;y+=2){Y0Ptr=y*strideY;Y1Ptr=Y0Ptr+strideY;CbPtr=ydec*strideCb;CrPtr=ydec*strideCr;for(x=0;x<
width;x+=2){colorCb=bytesCb[CbPtr++];colorCr=bytesCr[CrPtr++];multCrR=409*colorCr-57088;multCbCrG=100*colorCb+208*colorCr-34816;multCbB=516*colorCb-70912;multY=298*bytesY[Y0Ptr++];output[outPtr0++]=multY+multCrR>>8;output[outPtr0++]=multY-multCbCrG>>8;output[outPtr0++]=multY+multCbB>>8;outPtr0++;multY=298*bytesY[Y0Ptr++];output[outPtr0++]=multY+multCrR>>8;output[outPtr0++]=multY-multCbCrG>>8;output[outPtr0++]=multY+multCbB>>8;outPtr0++;multY=298*bytesY[Y1Ptr++];output[outPtr1++]=multY+multCrR>>8;
output[outPtr1++]=multY-multCbCrG>>8;output[outPtr1++]=multY+multCbB>>8;outPtr1++;multY=298*bytesY[Y1Ptr++];output[outPtr1++]=multY+multCrR>>8;output[outPtr1++]=multY-multCbCrG>>8;output[outPtr1++]=multY+multCbB>>8;outPtr1++}outPtr0+=outStride;outPtr1+=outStride;ydec++}}else{outPtr=0;for(y=0;y<height;y++){xdec=0;ydec=y>>vdec;YPtr=y*strideY;CbPtr=ydec*strideCb;CrPtr=ydec*strideCr;for(x=0;x<width;x++){xdec=x>>hdec;colorCb=bytesCb[CbPtr+xdec];colorCr=bytesCr[CrPtr+xdec];multCrR=409*colorCr-57088;multCbCrG=
100*colorCb+208*colorCr-34816;multCbB=516*colorCb-70912;multY=298*bytesY[YPtr++];output[outPtr++]=multY+multCrR>>8;output[outPtr++]=multY-multCbCrG>>8;output[outPtr++]=multY+multCbB>>8;outPtr++}}}}module.exports={convertYCbCr:convertYCbCr}})()},function(module,exports){(function(){function depower(ratio){var shiftCount=0,n=ratio>>1;while(n!=0){n=n>>1;shiftCount++}if(ratio!==1<<shiftCount)throw"chroma plane dimensions must be power of 2 ratio to luma plane dimensions; got "+ratio;return shiftCount}
module.exports=depower})()},function(module,exports,__webpack_require__){(function(){var FrameSink=__webpack_require__(13),shaders=__webpack_require__(18);function WebGLFrameSink(canvas){var self=this,gl=canvas.getContext("webgl")||canvas.getContext("experimental-webgl"),debug=false;if(gl===null)throw new Error("WebGL unavailable");function checkError(){if(debug){err=gl.getError();if(err!==0)throw new Error("GL error "+err);}}function compileShader(type,source){var shader=gl.createShader(type);gl.shaderSource(shader,
source);gl.compileShader(shader);if(!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){var err=gl.getShaderInfoLog(shader);gl.deleteShader(shader);throw new Error("GL shader compilation for "+type+" failed: "+err);}return shader}var vertexShader,fragmentShader,program,buf,err;var rectangle=new Float32Array([-1,-1,+1,-1,-1,+1,-1,+1,+1,-1,+1,+1]);var textures={};function attachTexture(name,register,index,width,height,data){var texture,texWidth=WebGLFrameSink.stripe?width/4:width,format=WebGLFrameSink.stripe?
gl.RGBA:gl.LUMINANCE,filter=WebGLFrameSink.stripe?gl.NEAREST:gl.LINEAR;if(textures[name])texture=textures[name];else{textures[name]=texture=gl.createTexture();checkError();gl.uniform1i(gl.getUniformLocation(program,name),index);checkError()}gl.activeTexture(register);checkError();gl.bindTexture(gl.TEXTURE_2D,texture);checkError();gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);checkError();gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);checkError();gl.texParameteri(gl.TEXTURE_2D,
gl.TEXTURE_MIN_FILTER,filter);checkError();gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,filter);checkError();gl.texImage2D(gl.TEXTURE_2D,0,format,texWidth,height,0,format,gl.UNSIGNED_BYTE,data);checkError();return texture}function buildStripe(width,height){var len=width*height,out=new Uint32Array(len);for(var i=0;i<len;i+=4){out[i]=255;out[i+1]=65280;out[i+2]=16711680;out[i+3]=4278190080}return new Uint8Array(out.buffer)}function init(buffer){vertexShader=compileShader(gl.VERTEX_SHADER,shaders.vertex);
if(WebGLFrameSink.stripe)fragmentShader=compileShader(gl.FRAGMENT_SHADER,shaders.fragmentStripe);else fragmentShader=compileShader(gl.FRAGMENT_SHADER,shaders.fragment);program=gl.createProgram();gl.attachShader(program,vertexShader);checkError();gl.attachShader(program,fragmentShader);checkError();gl.linkProgram(program);if(!gl.getProgramParameter(program,gl.LINK_STATUS)){var err=gl.getProgramInfoLog(program);gl.deleteProgram(program);throw new Error("GL program linking failed: "+err);}gl.useProgram(program);
checkError();if(WebGLFrameSink.stripe){attachTexture("uStripeLuma",gl.TEXTURE3,3,buffer.y.stride*4,buffer.format.height,buildStripe(buffer.y.stride,buffer.format.height));checkError();attachTexture("uStripeChroma",gl.TEXTURE4,4,buffer.u.stride*4,buffer.format.chromaHeight,buildStripe(buffer.u.stride,buffer.format.chromaHeight));checkError()}}self.drawFrame=function(buffer){var format=buffer.format;if(canvas.width!==format.displayWidth||canvas.height!==format.displayHeight){canvas.width=format.displayWidth;
canvas.height=format.displayHeight;self.clear()}if(!program)init(buffer);buf=gl.createBuffer();checkError();gl.bindBuffer(gl.ARRAY_BUFFER,buf);checkError();gl.bufferData(gl.ARRAY_BUFFER,rectangle,gl.STATIC_DRAW);checkError();var positionLocation=gl.getAttribLocation(program,"aPosition");checkError();gl.enableVertexAttribArray(positionLocation);checkError();gl.vertexAttribPointer(positionLocation,2,gl.FLOAT,false,0,0);checkError();function setupTexturePosition(varname,texWidth){var textureX0=format.cropLeft/
texWidth;var textureX1=(format.cropLeft+format.cropWidth)/texWidth;var textureY0=(format.cropTop+format.cropHeight)/format.height;var textureY1=format.cropTop/format.height;var textureRectangle=new Float32Array([textureX0,textureY0,textureX1,textureY0,textureX0,textureY1,textureX0,textureY1,textureX1,textureY0,textureX1,textureY1]);var texturePositionBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,texturePositionBuffer);checkError();gl.bufferData(gl.ARRAY_BUFFER,textureRectangle,gl.STATIC_DRAW);
checkError();var texturePositionLocation=gl.getAttribLocation(program,varname);checkError();gl.enableVertexAttribArray(texturePositionLocation);checkError();gl.vertexAttribPointer(texturePositionLocation,2,gl.FLOAT,false,0,0);checkError()}setupTexturePosition("aLumaPosition",buffer.y.stride);setupTexturePosition("aChromaPosition",buffer.u.stride*format.width/format.chromaWidth);var textureY=attachTexture("uTextureY",gl.TEXTURE0,0,buffer.y.stride,format.height,buffer.y.bytes);var textureCb=attachTexture("uTextureCb",
gl.TEXTURE1,1,buffer.u.stride,format.chromaHeight,buffer.u.bytes);var textureCr=attachTexture("uTextureCr",gl.TEXTURE2,2,buffer.v.stride,format.chromaHeight,buffer.v.bytes);gl.drawArrays(gl.TRIANGLES,0,rectangle.length/2);checkError()};self.clear=function(){gl.viewport(0,0,canvas.width,canvas.height);gl.clearColor(0,0,0,0);gl.clear(gl.COLOR_BUFFER_BIT)};self.clear();return self}WebGLFrameSink.stripe=function(){if(navigator.userAgent.indexOf("Windows")!==-1)return true;return false}();WebGLFrameSink.isAvailable=
function(){var canvas=document.createElement("canvas"),gl;canvas.width=1;canvas.height=1;var options={};try{gl=canvas.getContext("webgl",options)||canvas.getContext("experimental-webgl",options)}catch(e){return false}if(gl){var register=gl.TEXTURE0,width=4,height=4,texture=gl.createTexture(),data=new Uint8Array(width*height),texWidth=WebGLFrameSink.stripe?width/4:width,format=WebGLFrameSink.stripe?gl.RGBA:gl.LUMINANCE,filter=WebGLFrameSink.stripe?gl.NEAREST:gl.LINEAR;gl.activeTexture(register);gl.bindTexture(gl.TEXTURE_2D,
texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,filter);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,filter);gl.texImage2D(gl.TEXTURE_2D,0,format,texWidth,height,0,format,gl.UNSIGNED_BYTE,data);var err=gl.getError();if(err)return false;else return true}else return false};WebGLFrameSink.prototype=Object.create(FrameSink.prototype);module.exports=
WebGLFrameSink})()},function(module,exports){module.exports={vertex:"attribute vec2 aPosition;\nattribute vec2 aLumaPosition;\nattribute vec2 aChromaPosition;\nvarying vec2 vLumaPosition;\nvarying vec2 vChromaPosition;\nvoid main() {\n    gl_Position = vec4(aPosition, 0, 1);\n    vLumaPosition = aLumaPosition;\n    vChromaPosition = aChromaPosition;\n}\n",fragment:"// inspired by https://github.com/mbebenita/Broadway/blob/master/Player/canvas.js\n\nprecision mediump float;\nuniform sampler2D uTextureY;\nuniform sampler2D uTextureCb;\nuniform sampler2D uTextureCr;\nvarying vec2 vLumaPosition;\nvarying vec2 vChromaPosition;\nvoid main() {\n   // Y, Cb, and Cr planes are uploaded as LUMINANCE textures.\n   float fY = texture2D(uTextureY, vLumaPosition).x;\n   float fCb = texture2D(uTextureCb, vChromaPosition).x;\n   float fCr = texture2D(uTextureCr, vChromaPosition).x;\n\n   // Premultipy the Y...\n   float fYmul = fY * 1.1643828125;\n\n   // And convert that to RGB!\n   gl_FragColor = vec4(\n     fYmul + 1.59602734375 * fCr - 0.87078515625,\n     fYmul - 0.39176171875 * fCb - 0.81296875 * fCr + 0.52959375,\n     fYmul + 2.017234375   * fCb - 1.081390625,\n     1\n   );\n}\n",
fragmentStripe:"// inspired by https://github.com/mbebenita/Broadway/blob/master/Player/canvas.js\n// extra 'stripe' texture fiddling to work around IE 11's poor performance on gl.LUMINANCE and gl.ALPHA textures\n\nprecision mediump float;\nuniform sampler2D uStripeLuma;\nuniform sampler2D uStripeChroma;\nuniform sampler2D uTextureY;\nuniform sampler2D uTextureCb;\nuniform sampler2D uTextureCr;\nvarying vec2 vLumaPosition;\nvarying vec2 vChromaPosition;\nvoid main() {\n   // Y, Cb, and Cr planes are mapped into a pseudo-RGBA texture\n   // so we can upload them without expanding the bytes on IE 11\n   // which doesn\\'t allow LUMINANCE or ALPHA textures.\n   // The stripe textures mark which channel to keep for each pixel.\n   vec4 vStripeLuma = texture2D(uStripeLuma, vLumaPosition);\n   vec4 vStripeChroma = texture2D(uStripeChroma, vChromaPosition);\n\n   // Each texture extraction will contain the relevant value in one\n   // channel only.\n   vec4 vY = texture2D(uTextureY, vLumaPosition) * vStripeLuma;\n   vec4 vCb = texture2D(uTextureCb, vChromaPosition) * vStripeChroma;\n   vec4 vCr = texture2D(uTextureCr, vChromaPosition) * vStripeChroma;\n\n   // Now assemble that into a YUV vector, and premultipy the Y...\n   vec3 YUV = vec3(\n     (vY.x  + vY.y  + vY.z  + vY.w) * 1.1643828125,\n     (vCb.x + vCb.y + vCb.z + vCb.w),\n     (vCr.x + vCr.y + vCr.z + vCr.w)\n   );\n   // And convert that to RGB!\n   gl_FragColor = vec4(\n     YUV.x + 1.59602734375 * YUV.z - 0.87078515625,\n     YUV.x - 0.39176171875 * YUV.y - 0.81296875 * YUV.z + 0.52959375,\n     YUV.x + 2.017234375   * YUV.y - 1.081390625,\n     1\n   );\n}\n"}},
function(module,exports,__webpack_require__){var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,
staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function");}var EventEmitter=__webpack_require__(20);var CachePool=__webpack_require__(21);var Backend=__webpack_require__(24);var StreamFile=function(){function StreamFile(_ref){var _ref$url=_ref.url;var url=_ref$url===undefined?"":_ref$url;var _ref$chunkSize=_ref.chunkSize;var chunkSize=_ref$chunkSize===undefined?1*1024*1024:_ref$chunkSize;
var _ref$cacheSize=_ref.cacheSize;var cacheSize=_ref$cacheSize===undefined?0:_ref$cacheSize;_classCallCheck(this,StreamFile);this.length=-1;this.loaded=false;this.loading=false;this.seekable=false;this.buffering=false;this.seeking=false;Object.defineProperties(this,{offset:{get:function get(){return this._cache.readOffset}},eof:{get:function get(){return this.length===this._cache.readOffset}}});this.url=url;this.headers={};this._cache=new CachePool({cacheSize:cacheSize});this._backend=null;this._cachever=
0;this._chunkSize=chunkSize}_createClass(StreamFile,[{key:"load",value:function load(){var _this=this;return new Promise(function(resolve,reject){if(_this.loading)throw new Error("cannot load when loading");if(_this.loaded)throw new Error("cannot load when loaded");_this.loading=true;_this._openBackend().then(function(backend){_this.seekable=backend.seekable;_this.headers=backend.headers;_this.length=backend.length;_this.loaded=true;_this.loading=false;resolve()})["catch"](function(err){if(err.name!==
"AbortError")_this.loading=false;reject(err)})})}},{key:"_openBackend",value:function _openBackend(){var _this2=this;return new Promise(function(resolve,reject){if(_this2._backend)resolve(_this2._backend);else if(_this2.eof)reject(new Error("cannot open at end of file"));else{var cache=_this2._cache;var max=_this2._chunkSize;var readable=cache.bytesReadable(max);var readTail=cache.readOffset+readable;cache.seekWrite(readTail);if(_this2.length>=0&&readTail>=_this2.length){resolve(null);return}var writable=
cache.bytesWritable(max);if(writable===0)resolve(null);else(function(){var backend=_this2._backend=new Backend({url:_this2.url,offset:_this2._cache.writeOffset,length:writable,cachever:_this2._cachever});var oncomplete=null;var checkOpen=function checkOpen(){if(backend!==_this2._backend){oncomplete();reject(new Error("invalid state"))}else{backend.on("buffer",function(buffer){if(backend===_this2._backend)_this2._cache.write(buffer)});backend.on("done",function(){if(backend===_this2._backend){if(_this2.length===
-1)_this2.length=_this2._backend.offset+_this2._backend.bytesRead;_this2._backend=null}});resolve(backend)}};var checkError=function checkError(err){if(backend!==_this2._backend)reject(new Error("invalid state"));else{_this2._backend=null;reject(err)}};oncomplete=function oncomplete(){backend.off("open",checkOpen);backend.off("error",checkError)};backend.on("open",checkOpen);backend.on("error",checkError);backend.on("cachever",function(){_this2._cachever++});backend.load()})()}})}},{key:"_readAhead",
value:function _readAhead(){var _this3=this;return new Promise(function(resolve,reject){if(_this3._backend||_this3.eof)resolve();else _this3._openBackend().then(function(){resolve()})["catch"](function(err){reject(err)})})}},{key:"seek",value:function seek(offset){var _this4=this;return new Promise(function(resolve,reject){if(!_this4.loaded||_this4.buffering||_this4.seeking)throw new Error("invalid state");else if(offset!==(offset|0)||offset<0)throw new Error("invalid input");else if(_this4.length>=
0&&offset>_this4.length)throw new Error("seek past end of file");else if(!_this4.seekable)throw new Error("seek on non-seekable stream");else{if(_this4._backend)_this4.abort();_this4._cache.seekRead(offset);_this4._cache.seekWrite(offset);_this4._readAhead().then(resolve)["catch"](reject)}})}},{key:"read",value:function read(nbytes){var _this5=this;return this.buffer(nbytes).then(function(available){return _this5.readSync(available)})}},{key:"readSync",value:function readSync(nbytes){var available=
this.bytesAvailable(nbytes);var dest=new Uint8Array(available);var actual=this.readBytes(dest);if(actual!==available)throw new Error("failed to read expected data");return dest.buffer}},{key:"readBytes",value:function readBytes(dest){if(!this.loaded||this.buffering||this.seeking)throw new Error("invalid state");else if(!(dest instanceof Uint8Array))throw new Error("invalid input");var nbytes=this._cache.readBytes(dest);this._readAhead();return nbytes}},{key:"buffer",value:function buffer(nbytes){var _this6=
this;return new Promise(function(resolve,reject){if(!_this6.loaded||_this6.buffering||_this6.seeking)throw new Error("invalid state");else if(nbytes!==(nbytes|0)||nbytes<0)throw new Error("invalid input");var end=_this6._clampToLength(_this6.offset+nbytes);var readable=end-_this6.offset;var canceled=false;var available=_this6.bytesAvailable(readable);if(available>=readable)resolve(available);else{_this6.buffering=true;_this6._openBackend().then(function(backend){if(backend)return backend.bufferToOffset(end).then(function(){_this6.buffering=
false;return _this6.buffer(nbytes)});else return Promise.resolve(available)}).then(function(available){_this6.buffering=false;resolve(available)})["catch"](function(err){if(err.name!=="AbortError")_this6.buffering=false;reject(err)})}})}},{key:"bytesAvailable",value:function bytesAvailable(){var max=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Infinity;return this._cache.bytesReadable(max)}},{key:"abort",value:function abort(){if(this.loading)this.loading=false;if(this.buffering)this.buffering=
false;if(this.seeking)this.seeking=false;if(this._backend){this._backend.abort();this._backend=null}}},{key:"getBufferedRanges",value:function getBufferedRanges(){return this._cache.ranges()}},{key:"_clampToLength",value:function _clampToLength(offset){if(this.length<0)return offset;else return Math.min(this.length,offset)}}]);return StreamFile}();module.exports=StreamFile},function(module,exports){var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=
props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function");
}var TinyEvents=function(){function TinyEvents(){_classCallCheck(this,TinyEvents);this._e={}}_createClass(TinyEvents,[{key:"on",value:function on(name,handler){(this._e[name]||(this._e[name]=[])).push(handler)}},{key:"off",value:function off(name,handler){var l=this._e[name]||[];var i=l.indexOf(handler);if(handler>=0)l.splice(i,1)}},{key:"emit",value:function emit(name,arg){(this._e[name]||[]).slice().forEach(function(f){return f(arg)})}}]);return TinyEvents}();module.exports=TinyEvents},function(module,
exports,__webpack_require__){module.exports=__webpack_require__(22)},function(module,exports,__webpack_require__){var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,
protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function");}var CacheItem=__webpack_require__(23);var CachePool=function(){function CachePool(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref$cacheSize=_ref.cacheSize;var cacheSize=_ref$cacheSize===undefined?0:_ref$cacheSize;_classCallCheck(this,
CachePool);var eof=new CacheItem({eof:true});this.head=eof;this.tail=eof;this.readOffset=0;this.readCursor=eof;this.writeOffset=0;this.writeCursor=eof;this.cacheSize=cacheSize}_createClass(CachePool,[{key:"bytesReadable",value:function bytesReadable(){var max=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Infinity;var offset=this.readOffset;var cursor=this.readCursor;var last=cursor.last(function(item){return!item.empty&&item.start<=offset+max});if(last)return Math.min(max,last.end-offset);
return 0}},{key:"bytesWritable",value:function bytesWritable(){var max=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Infinity;var offset=this.writeOffset;var cursor=this.writeCursor;if(cursor.eof)return max;var last=cursor.last(function(item){return item.empty&&item.start<=offset+max});if(last)return Math.min(max,last.end-offset);return 0}},{key:"seekRead",value:function seekRead(offset){var target=this.head.first(function(item){return item.contains(offset)});if(!target)throw new Error("read seek out of range");
this.readOffset=offset;this.readCursor=target}},{key:"seekWrite",value:function seekWrite(offset){var target=this.head.first(function(item){return item.contains(offset)});if(!target)throw new Error("write seek out of range");this.writeOffset=offset;this.writeCursor=target}},{key:"readBytes",value:function readBytes(dest){var nbytes=dest.byteLength;var len=this.bytesReadable(nbytes);var start=this.readOffset;var end=start+len;var readHead=start;var writeHead=0;for(var item=this.readCursor;item;item=
item.next){if(item.empty)break;if(item.start>=end)break;var readTail=Math.min(end,item.end);var chunk=dest.subarray(readHead-start,readTail-start);item.readBytes(chunk,readHead,readTail);readHead=readTail}this.readOffset=readHead;this.readCursor=this.readCursor.first(function(item){return item.contains(readHead)});return len}},{key:"write",value:function write(buffer){var item=this.bufferItem(buffer);var cursor=this.writeCursor;if(!cursor.empty)throw new Error("write cursor not empty");if(!cursor.contains(item.end)&&
cursor.end!==item.end)throw new Error("write cursor too small");if(cursor.start<item.start){this.split(cursor,item.start);cursor=this.writeCursor}if(item.end<cursor.end||cursor.eof){this.split(cursor,item.end);cursor=this.writeCursor}this.splice(cursor,cursor,item,item);this.writeOffset=item.end;this.writeCursor=item.next;this.gc()}},{key:"bufferItem",value:function bufferItem(buffer){if(buffer instanceof ArrayBuffer)return new CacheItem({start:this.writeOffset,end:this.writeOffset+buffer.byteLength,
buffer:buffer});else if(typeof buffer==="string")return new CacheItem({start:this.writeOffset,end:this.writeOffset+buffer.length,string:buffer});else throw new Error("invalid input to write");}},{key:"split",value:function split(oldItem,offset){var items=oldItem.split(offset);this.splice(oldItem,oldItem,items[0],items[1])}},{key:"ranges",value:function ranges(){var ranges=[];for(var item=this.head;item;item=item.next){if(item.empty)continue;var start=item;item=item.last(function(i){return!i.empty});
ranges.push([start.start,item.end])}return ranges}},{key:"gc",value:function gc(){var cachedBytes=0;var candidates=[];for(var item=this.head;item;item=item.next)if(!item.empty){cachedBytes+=item.length;if(item.end<this.readOffset||item.start>this.readOffset+this.chunkSize)candidates.push(item)}if(cachedBytes>this.cacheSize){candidates.sort(function(a,b){return a.timestamp-b.timestamp});for(var i=0;i<candidates.length;i++){var _item=candidates[i];if(cachedBytes<=this.cacheSize)break;this.remove(_item);
cachedBytes-=_item.length}}}},{key:"remove",value:function remove(item){var replacement=new CacheItem({start:item.start,end:item.end});this.splice(item,item,replacement,replacement);item=replacement;if(item.prev&&item.prev.empty)item=this.consolidate(item.prev);if(item.next&&item.next.empty&&!item.next.eof)item=this.consolidate(item);if(item.start===0)this.head=item}},{key:"consolidate",value:function consolidate(first){var last=first.last(function(item){return item.empty&&!item.eof});var replacement=
new CacheItem({start:first.start,end:last.end});this.splice(first,last,replacement,replacement);return replacement}},{key:"splice",value:function splice(oldHead,oldTail,newHead,newTail){var _this=this;if(oldHead.start!==newHead.start)throw new Error("invalid splice head");if(oldTail.end!==newTail.end)if(oldTail.eof&&newTail.eof);else throw new Error("invalid splice tail");var prev=oldHead.prev;var next=oldTail.next;oldHead.prev=null;oldTail.next=null;if(prev){prev.next=newHead;newHead.prev=prev}if(next){next.prev=
newTail;newTail.next=next}if(oldHead===this.head)this.head=newHead;if(oldTail===this.tail)this.tail=newTail;this.readCursor=this.head.first(function(item){return item.contains(_this.readOffset)});this.writeCursor=this.head.first(function(item){return item.contains(_this.writeOffset)})}},{key:"eof",get:function get(){return this.readCursor.eof}}]);return CachePool}();module.exports=CachePool},function(module,exports){var _createClass=function(){function defineProperties(target,props){for(var i=0;i<
props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function");
}var CacheItem=function(){function CacheItem(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var _ref$buffer=_ref.buffer;var buffer=_ref$buffer===undefined?undefined:_ref$buffer;var _ref$string=_ref.string;var string=_ref$string===undefined?undefined:_ref$string;var _ref$start=_ref.start;var start=_ref$start===undefined?0:_ref$start;var _ref$end=_ref.end;var end=_ref$end===undefined?start+(buffer?buffer.byteLength:string?string.length:0):_ref$end;var _ref$prev=_ref.prev;var prev=
_ref$prev===undefined?null:_ref$prev;var _ref$next=_ref.next;var next=_ref$next===undefined?null:_ref$next;var _ref$eof=_ref.eof;var eof=_ref$eof===undefined?false:_ref$eof;var _ref$empty=_ref.empty;var empty=_ref$empty===undefined?!(buffer||string):_ref$empty;var _ref$timestamp=_ref.timestamp;var timestamp=_ref$timestamp===undefined?Date.now():_ref$timestamp;_classCallCheck(this,CacheItem);this.start=start;this.end=end;this.prev=prev;this.next=next;this.eof=eof;this.empty=empty;this.timestamp=timestamp;
this.buffer=buffer;this.string=string;Object.defineProperty(this,"length",{get:function get(){return this.end-this.start}})}_createClass(CacheItem,[{key:"contains",value:function contains(offset){return offset>=this.start&&(offset<this.end||this.eof)}},{key:"readBytes",value:function readBytes(dest,start,end){var readHead=start-this.start;var len=end-start;if(this.buffer){var sourceBytes=new Uint8Array(this.buffer,readHead,len);dest.set(sourceBytes)}else if(this.string){var chunk=this.string;for(var i=
0;i<len;i++)dest[i]=chunk.charCodeAt(readHead+i)}else throw new Error("invalid state");this.timestamp=Date.now()}},{key:"split",value:function split(offset){if(!this.empty||!this.contains(offset))throw new Error("invalid split");var a=new CacheItem({start:this.start,end:offset});var b=new CacheItem({start:offset,end:this.eof?offset:this.end,eof:this.eof});a.next=b;b.prev=a;return[a,b]}},{key:"first",value:function first(callback){for(var item=this;item;item=item.next)if(callback(item))return item;
return null}},{key:"last",value:function last(callback){var last=null;for(var item=this;item;item=item.next){if(!callback(item))break;last=item}return last}}]);return CacheItem}();module.exports=CacheItem},function(module,exports,__webpack_require__){var MozChunkedBackend=__webpack_require__(25);var MSStreamBackend=__webpack_require__(28);var BinaryStringBackend=__webpack_require__(29);function autoselect(){if(MozChunkedBackend.supported())return MozChunkedBackend;else if(BinaryStringBackend.supported())return BinaryStringBackend;
else if(MSStreamBackend.supported())return MSStreamBackend;else return null}var backendClass=null;function instantiate(options){if(!backendClass)backendClass=autoselect();if(!backendClass)throw new Error("No supported backend class");return new backendClass(options)}module.exports=instantiate},function(module,exports,__webpack_require__){var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||
false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=
Object.getPrototypeOf(object);if(parent===null)return undefined;else return get(parent,property,receiver)}else if("value"in desc)return desc.value;else{var getter=desc.get;if(getter===undefined)return undefined;return getter.call(receiver)}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function");}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=
superClass}var DownloadBackend=__webpack_require__(26);var type="moz-chunked-arraybuffer";var MozChunkedBackend=function(_DownloadBackend){_inherits(MozChunkedBackend,_DownloadBackend);function MozChunkedBackend(){_classCallCheck(this,MozChunkedBackend);return _possibleConstructorReturn(this,(MozChunkedBackend.__proto__||Object.getPrototypeOf(MozChunkedBackend)).apply(this,arguments))}_createClass(MozChunkedBackend,[{key:"initXHR",value:function initXHR(){_get(MozChunkedBackend.prototype.__proto__||
Object.getPrototypeOf(MozChunkedBackend.prototype),"initXHR",this).call(this);this.xhr.responseType=type}},{key:"onXHRProgress",value:function onXHRProgress(){var buffer=this.xhr.response;this.bytesRead+=buffer.byteLength;this.emit("buffer",buffer)}}]);return MozChunkedBackend}(DownloadBackend);MozChunkedBackend.supported=function(){try{var xhr=new XMLHttpRequest;xhr.responseType=type;return xhr.responseType===type}catch(e){return false}};module.exports=MozChunkedBackend},function(module,exports,
__webpack_require__){var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);
return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null)return undefined;else return get(parent,property,receiver)}else if("value"in desc)return desc.value;else{var getter=desc.get;if(getter===undefined)return undefined;return getter.call(receiver)}};function _classCallCheck(instance,Constructor){if(!(instance instanceof
Constructor))throw new TypeError("Cannot call a class as a function");}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&
superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Backend=__webpack_require__(27);var DownloadBackend=function(_Backend){_inherits(DownloadBackend,_Backend);function DownloadBackend(){_classCallCheck(this,DownloadBackend);return _possibleConstructorReturn(this,(DownloadBackend.__proto__||Object.getPrototypeOf(DownloadBackend)).apply(this,
arguments))}_createClass(DownloadBackend,[{key:"bufferToOffset",value:function bufferToOffset(end){var _this2=this;return new Promise(function(resolve,reject){if(_this2.eof||_this2.offset>=end)resolve();else(function(){var oncomplete=null;_this2._onAbort=function(err){oncomplete();reject(reason)};var checkBuffer=function checkBuffer(){if(_this2.offset>=end&&!_this2.eof){oncomplete();resolve()}};var checkDone=function checkDone(){oncomplete();resolve()};var checkError=function checkError(){oncomplete();
reject(new Error("error streaming"))};oncomplete=function oncomplete(){_this2.buffering=false;_this2.off("buffer",checkBuffer);_this2.off("done",checkDone);_this2.off("error",checkError);_this2._onAbort=null};_this2.buffering=true;_this2.on("buffer",checkBuffer);_this2.on("done",checkDone);_this2.on("error",checkError)})()})}},{key:"initXHR",value:function initXHR(){_get(DownloadBackend.prototype.__proto__||Object.getPrototypeOf(DownloadBackend.prototype),"initXHR",this).call(this)}},{key:"onXHRStart",
value:function onXHRStart(){var _this3=this;this.xhr.addEventListener("progress",function(){return _this3.onXHRProgress()});this.xhr.addEventListener("error",function(){return _this3.onXHRError()});this.xhr.addEventListener("load",function(){return _this3.onXHRLoad()});this.emit("open")}},{key:"onXHRProgress",value:function onXHRProgress(){throw new Error("abstract");}},{key:"onXHRError",value:function onXHRError(){this.emit("error")}},{key:"onXHRLoad",value:function onXHRLoad(){this.eof=true;this.emit("done")}}]);
return DownloadBackend}(Backend);module.exports=DownloadBackend},function(module,exports,__webpack_require__){var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,
protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function");}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!==
"function"&&superClass!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var TinyEvents=__webpack_require__(20);function getXHRLength(xhr){if(xhr.status==206)return getXHRRangeTotal(xhr);else{var contentLength=
xhr.getResponseHeader("Content-Length");if(contentLength===null||contentLength==="")return-1;else return parseInt(contentLength,10)}}function getXHRRangeMatches(xhr){var contentRange=xhr.getResponseHeader("Content-Range");return contentRange&&contentRange.match(/^bytes (\d+)-(\d+)\/(\d+)/)}function getXHRRangeStart(xhr){var matches=getXHRRangeMatches(xhr);if(matches)return parseInt(matches[1],10);else return 0}function getXHRRangeTotal(xhr){var matches=getXHRRangeMatches(xhr);if(matches)return parseInt(matches[3],
10);else return-1}function getXHRHeaders(xhr){var headers={};var headerLines=xhr.getAllResponseHeaders().split(/\n/);headerLines.forEach(function(line){var bits=line.split(/:\s*/,2);if(bits.length>1)headers[bits[0].toLowerCase()]=bits[1]});return headers}var Backend=function(_TinyEvents){_inherits(Backend,_TinyEvents);function Backend(_ref){var url=_ref.url;var offset=_ref.offset;var length=_ref.length;var _ref$cachever=_ref.cachever;var cachever=_ref$cachever===undefined?0:_ref$cachever;_classCallCheck(this,
Backend);var _this=_possibleConstructorReturn(this,(Backend.__proto__||Object.getPrototypeOf(Backend)).call(this));_this.url=url;_this.offset=offset;_this.length=length;_this.cachever=cachever;_this.loaded=false;_this.seekable=false;_this.headers={};_this.eof=false;_this.bytesRead=0;_this.xhr=new XMLHttpRequest;return _this}_createClass(Backend,[{key:"load",value:function load(){var _this2=this;return new Promise(function(resolve,reject){var oncomplete=null;_this2._onAbort=function(err){oncomplete();
reject(err)};var checkOpen=function checkOpen(){if(_this2.xhr.readyState==2){if(_this2.xhr.status==206){var foundPosition=getXHRRangeStart(_this2.xhr);if(_this2.offset!=foundPosition){console.log("Expected start at "+_this2.offset+" but got "+foundPosition+"; working around Safari range caching bug: https://bugs.webkit.org/show_bug.cgi?id=82672");_this2.cachever++;_this2.emit("cachever");_this2.abort();oncomplete();_this2.load().then(resolve)["catch"](reject);return}_this2.seekable=true}if(_this2.xhr.status>=
200&&_this2.xhr.status<300){_this2.length=getXHRLength(_this2.xhr);_this2.headers=getXHRHeaders(_this2.xhr);_this2.onXHRStart();if(_this2.xhr.responseURL&&_this2.xhr.responseURL.substr(0,5)=="data:")_this2.seekable=true}else{oncomplete();reject(new Error("HTTP error "+_this2.xhr.status))}}};var checkError=function checkError(){oncomplete();reject(new Error("network error"))};var checkBackendOpen=function checkBackendOpen(){oncomplete();resolve()};oncomplete=function oncomplete(){_this2.xhr.removeEventListener("readystatechange",
checkOpen);_this2.xhr.removeEventListener("error",checkError);_this2.off("open",checkBackendOpen);_this2._onAbort=null};_this2.initXHR();_this2.xhr.addEventListener("readystatechange",checkOpen);_this2.xhr.addEventListener("error",checkError);_this2.on("open",checkBackendOpen);_this2.xhr.send()})}},{key:"bufferToOffset",value:function bufferToOffset(end){return Promise.reject(new Error("abstract"))}},{key:"abort",value:function abort(){this.xhr.abort();if(this._onAbort){var onAbort=this._onAbort;
this._onAbort=null;var err=new Error("Aborted");err.name="AbortError";onAbort(err)}}},{key:"initXHR",value:function initXHR(){var getUrl=this.url;if(this.cachever)getUrl+="?buggy_cachever="+this.cachever;this.xhr.open("GET",getUrl);var range=null;if(this.offset||this.length)range="bytes="+this.offset+"-";if(this.length)range+=this.offset+this.length-1;if(range!==null)this.xhr.setRequestHeader("Range",range)}},{key:"onXHRStart",value:function onXHRStart(){throw new Error("abstract");}}]);return Backend}(TinyEvents);
module.exports=Backend},function(module,exports,__webpack_require__){var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,
staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null)return undefined;else return get(parent,property,receiver)}else if("value"in desc)return desc.value;else{var getter=desc.get;if(getter===undefined)return undefined;return getter.call(receiver)}};function _classCallCheck(instance,Constructor){if(!(instance instanceof
Constructor))throw new TypeError("Cannot call a class as a function");}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&
superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Backend=__webpack_require__(27);var type="ms-stream";var MSStreamBackend=function(_Backend){_inherits(MSStreamBackend,_Backend);function MSStreamBackend(options){_classCallCheck(this,MSStreamBackend);var _this=_possibleConstructorReturn(this,(MSStreamBackend.__proto__||Object.getPrototypeOf(MSStreamBackend)).call(this,
options));_this.stream=null;_this.streamReader=null;return _this}_createClass(MSStreamBackend,[{key:"initXHR",value:function initXHR(){_get(MSStreamBackend.prototype.__proto__||Object.getPrototypeOf(MSStreamBackend.prototype),"initXHR",this).call(this);this.xhr.responseType=type}},{key:"onXHRStart",value:function onXHRStart(){var _this2=this;var checkProgress=function checkProgress(){if(_this2.xhr.readyState===3){_this2.stream=_this2.xhr.response;_this2.xhr.removeEventListener("readystatechange",
checkProgress);_this2.emit("open")}};this.xhr.addEventListener("readystatechange",checkProgress)}},{key:"waitForStream",value:function waitForStream(){var _this3=this;return new Promise(function(resolve,reject){if(_this3.stream)resolve(_this3.stream);else(function(){var oncomplete=null;_this3._onAbort=function(err){oncomplete();reject(err)};var checkStart=function checkStart(){resolve(_this3.stream)};oncomplete=function oncomplete(){_this3.off("open",checkStart);_this3._onAbort=null};_this3.on("open",
checkStart)})()})}},{key:"bufferToOffset",value:function bufferToOffset(end){var _this4=this;return this.waitForStream().then(function(stream){return new Promise(function(resolve,reject){if(_this4.streamReader)throw new Error("cannot trigger read when reading");if(_this4.offset>=end||_this4.eof)resolve();else{var nbytes=end-_this4.offset;_this4.streamReader=new MSStreamReader;_this4.streamReader.onload=function(event){_this4.streamReader=null;var buffer=event.target.result;if(buffer.byteLength>0){_this4.bytesRead+=
buffer.byteLength;_this4.emit("buffer",buffer)}else{_this4.eof=true;_this4.emit("done")}resolve()};_this4.streamReader.onerror=function(){_this4.streamReader=null;_this4.stream=null;_this4.emit("error");reject(new Error("mystery error streaming"))};_this4._onAbort=function(err){_this4.streamReader.abort();_this4.streamReader=null;_this4.stream=null;_this4.emit("error");reject(reason)};_this4.streamReader.readAsArrayBuffer(stream,nbytes)}})})}},{key:"abort",value:function abort(){if(this.streamReader){this.streamReader.abort();
this.streamReader=null}if(this.stream){this.stream.msClose();this.stream=null}_get(MSStreamBackend.prototype.__proto__||Object.getPrototypeOf(MSStreamBackend.prototype),"abort",this).call(this)}}]);return MSStreamBackend}(Backend);MSStreamBackend.supported=function(){try{var xhr=new XMLHttpRequest;xhr.open("GET","/robots.txt");xhr.responseType=type;return xhr.responseType===type}catch(e){return false}};module.exports=MSStreamBackend},function(module,exports,__webpack_require__){var _createClass=function(){function defineProperties(target,
props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===
null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null)return undefined;else return get(parent,property,receiver)}else if("value"in desc)return desc.value;else{var getter=desc.get;if(getter===undefined)return undefined;return getter.call(receiver)}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function");
}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,
enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DownloadBackend=__webpack_require__(26);var BinaryStringBackend=function(_DownloadBackend){_inherits(BinaryStringBackend,_DownloadBackend);function BinaryStringBackend(){_classCallCheck(this,BinaryStringBackend);return _possibleConstructorReturn(this,(BinaryStringBackend.__proto__||Object.getPrototypeOf(BinaryStringBackend)).apply(this,
arguments))}_createClass(BinaryStringBackend,[{key:"initXHR",value:function initXHR(){_get(BinaryStringBackend.prototype.__proto__||Object.getPrototypeOf(BinaryStringBackend.prototype),"initXHR",this).call(this);this.xhr.responseType="text";this.xhr.overrideMimeType("text/plain; charset=x-user-defined")}},{key:"onXHRProgress",value:function onXHRProgress(){var slice=this.xhr.responseText.slice(this.bytesRead);if(slice.length>0){this.bytesRead+=slice.length;this.emit("buffer",slice)}}},{key:"onXHRLoad",
value:function onXHRLoad(){this.onXHRProgress();_get(BinaryStringBackend.prototype.__proto__||Object.getPrototypeOf(BinaryStringBackend.prototype),"onXHRLoad",this).call(this)}}]);return BinaryStringBackend}(DownloadBackend);BinaryStringBackend.supported=function(){try{var xhr=new XMLHttpRequest;return!!xhr.overrideMimeType}catch(e){return false}};module.exports=BinaryStringBackend},function(module,exports,__webpack_require__){(function webpackUniversalModuleDefinition(root,factory){if(true)module.exports=
factory();else if(typeof define==="function"&&define.amd)define([],factory);else if(typeof exports==="object")exports["AudioFeeder"]=factory();else root["AudioFeeder"]=factory()})(this,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);
module.loaded=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0)}([function(module,exports,__webpack_require__){(function(){var BufferQueue=__webpack_require__(1),WebAudioBackend=__webpack_require__(2),FlashBackend=__webpack_require__(4);function AudioFeeder(options){this._options=options||{};this._backend=null}AudioFeeder.prototype.rate=0;AudioFeeder.prototype.targetRate=0;AudioFeeder.prototype.channels=
0;AudioFeeder.prototype.bufferSize=0;Object.defineProperty(AudioFeeder.prototype,"bufferDuration",{get:function getBufferDuration(){if(this.targetRate)return this.bufferSize/this.targetRate;else return 0}});Object.defineProperty(AudioFeeder.prototype,"bufferThreshold",{get:function getBufferThreshold(){if(this._backend)return this._backend.bufferThreshold/this.targetRate;else return 0},set:function setBufferThreshold(val){if(this._backend)this._backend.bufferThreshold=Math.round(val*this.targetRate);
else throw"Invalid state: AudioFeeder cannot set bufferThreshold before init";}});Object.defineProperty(AudioFeeder.prototype,"playbackPosition",{get:function getPlaybackPosition(){if(this._backend){var playbackState=this.getPlaybackState();return playbackState.playbackPosition}else return 0}});Object.defineProperty(AudioFeeder.prototype,"durationBuffered",{get:function getDurationBuffered(){if(this._backend){var playbackState=this.getPlaybackState();return playbackState.samplesQueued/this.targetRate}else return 0}});
Object.defineProperty(AudioFeeder.prototype,"muted",{get:function getMuted(){if(this._backend)return this._backend.muted;else throw"Invalid state: cannot get mute before init";},set:function setMuted(val){if(this._backend)this._backend.muted=val;else throw"Invalid state: cannot set mute before init";}});AudioFeeder.prototype.mute=function(){this.muted=true};AudioFeeder.prototype.unmute=function(){this.muted=false};Object.defineProperty(AudioFeeder.prototype,"volume",{get:function getVolume(){if(this._backend)return this._backend.volume;
else throw"Invalid state: cannot get volume before init";},set:function setVolume(val){if(this._backend)this._backend.volume=val;else throw"Invalid state: cannot set volume before init";}});AudioFeeder.prototype.init=function(numChannels,sampleRate){this.channels=numChannels;this.rate=sampleRate;if(WebAudioBackend.isSupported())this._backend=new WebAudioBackend(numChannels,sampleRate,this._options);else if(FlashBackend.isSupported())this._backend=new FlashBackend(numChannels,sampleRate,this._options);
else throw"No supported backend";this.targetRate=this._backend.rate;this.bufferSize=this._backend.bufferSize;this._backend.onstarved=function(){if(this.onstarved)this.onstarved()}.bind(this);this._backend.onbufferlow=function(){if(this.onbufferlow)this.onbufferlow()}.bind(this)};AudioFeeder.prototype._resample=function(sampleData){var rate=this.rate,channels=this.channels,targetRate=this._backend.rate,targetChannels=this._backend.channels;if(rate==targetRate&&channels==targetChannels)return sampleData;
else{var newSamples=[];for(var channel=0;channel<targetChannels;channel++){var inputChannel=channel;if(channel>=channels)inputChannel=0;var input=sampleData[inputChannel],output=new Float32Array(Math.round(input.length*targetRate/rate));for(var i=0;i<output.length;i++)output[i]=input[i*rate/targetRate|0];newSamples.push(output)}return newSamples}};AudioFeeder.prototype.bufferData=function(sampleData){if(this._backend){var samples=this._resample(sampleData);this._backend.appendBuffer(samples)}else throw"Invalid state: AudioFeeder cannot bufferData before init";
};AudioFeeder.prototype.getPlaybackState=function(){if(this._backend)return this._backend.getPlaybackState();else throw"Invalid state: AudioFeeder cannot getPlaybackState before init";};AudioFeeder.prototype.waitUntilReady=function(callback){if(this._backend)this._backend.waitUntilReady(callback);else throw"Invalid state: AudioFeeder cannot waitUntilReady before init";};AudioFeeder.prototype.start=function(){if(this._backend)this._backend.start();else throw"Invalid state: AudioFeeder cannot start before init";
};AudioFeeder.prototype.stop=function(){if(this._backend)this._backend.stop();else throw"Invalid state: AudioFeeder cannot stop before init";};AudioFeeder.prototype.flush=function(){if(this._backend)this._backend.flush();else throw"Invalid state: AudioFeeder cannot flush before init";};AudioFeeder.prototype.close=function(){if(this._backend){this._backend.close();this._backend=null}};AudioFeeder.prototype.onstarved=null;AudioFeeder.prototype.onbufferlow=null;AudioFeeder.isSupported=function(){return!!Float32Array&&
(WebAudioBackend.isSupported()||FlashBackend.isSupported())};AudioFeeder.initSharedAudioContext=function(){if(WebAudioBackend.isSupported())return WebAudioBackend.initSharedAudioContext();else return null};module.exports=AudioFeeder})()},function(module,exports){function BufferQueue(numChannels,bufferSize){if(numChannels<1||numChannels!==Math.round(numChannels))throw"Invalid channel count for BufferQueue";this.channels=numChannels;this.bufferSize=bufferSize;this.flush()}BufferQueue.prototype.flush=
function(){this._buffers=[];this._pendingBuffer=this.createBuffer(this.bufferSize);this._pendingPos=0};BufferQueue.prototype.sampleCount=function(){var count=0;this._buffers.forEach(function(buffer){count+=buffer[0].length});return count};BufferQueue.prototype.createBuffer=function(sampleCount){var output=[];for(var i=0;i<this.channels;i++)output[i]=new Float32Array(sampleCount);return output};BufferQueue.prototype.validate=function(buffer){if(buffer.length!==this.channels)return false;var sampleCount;
for(var i=0;i<buffer.length;i++){var channelData=buffer[i];if(!(channelData instanceof Float32Array))return false;if(i==0)sampleCount=channelData.length;else if(channelData.length!==sampleCount)return false}return true};BufferQueue.prototype.appendBuffer=function(sampleData){if(!this.validate(sampleData))throw"Invalid audio buffer passed to BufferQueue.appendBuffer";var firstChannel=sampleData[0],sampleCount=firstChannel.length;for(var i=0;i<sampleCount;i++){for(var channel=0;channel<this.channels;channel++)this._pendingBuffer[channel][this._pendingPos]=
sampleData[channel][i];if(++this._pendingPos==this.bufferSize){this._buffers.push(this._pendingBuffer);this._pendingPos=0;this._pendingBuffer=this.createBuffer(this.bufferSize)}}};BufferQueue.prototype.prependBuffer=function(sampleData){if(!this.validate(sampleData))throw"Invalid audio buffer passed to BufferQueue.prependBuffer";var buffers=this._buffers.slice(0);buffers.push(this.trimBuffer(this._pendingBuffer,0,this._pendingPos));this.flush();this.appendBuffer(sampleData);for(var i=0;i<buffers.length;i++)this.appendBuffer(buffers[i])};
BufferQueue.prototype.nextBuffer=function(){if(this._buffers.length)return this._buffers.shift();else{var trimmed=this.trimBuffer(this._pendingBuffer,0,this._pendingPos);this._pendingBuffer=this.createBuffer(this.bufferSize);this._pendingPos=0;return trimmed}};BufferQueue.prototype.trimBuffer=function(sampleData,start,maxSamples){var bufferLength=sampleData[0].length,end=start+Math.min(maxSamples,bufferLength);if(start==0&&end>=bufferLength)return sampleData;else{var output=[];for(var i=0;i<this.channels;i++)output[i]=
sampleData[i].subarray(start,end);return output}};module.exports=BufferQueue},function(module,exports,__webpack_require__){(function(){var AudioContext=window.AudioContext||window.webkitAudioContext,BufferQueue=__webpack_require__(1),nextTick=__webpack_require__(3);function WebAudioBackend(numChannels,sampleRate,options){var context=options.audioContext||WebAudioBackend.initSharedAudioContext();this._context=context;this.output=options.output||context.destination;this.rate=context.sampleRate;this.channels=
Math.min(numChannels,2);if(options.bufferSize)this.bufferSize=options.bufferSize|0;this.bufferThreshold=2*this.bufferSize;this._bufferQueue=new BufferQueue(this.channels,this.bufferSize);this._playbackTimeAtBufferTail=context.currentTime;this._queuedTime=0;this._delayedTime=0;this._dropped=0;this._liveBuffer=this._bufferQueue.createBuffer(this.bufferSize);if(context.createScriptProcessor)this._node=context.createScriptProcessor(this.bufferSize,0,this.channels);else if(context.createJavaScriptNode)this._node=
context.createJavaScriptNode(this.bufferSize,0,this.channels);else throw new Error("Bad version of web audio API?");}WebAudioBackend.prototype.bufferSize=4096;WebAudioBackend.prototype.bufferThreshold=8192;WebAudioBackend.prototype._volume=1;Object.defineProperty(WebAudioBackend.prototype,"volume",{get:function getVolume(){return this._volume},set:function setVolume(val){this._volume=+val}});WebAudioBackend.prototype._muted=false;Object.defineProperty(WebAudioBackend.prototype,"muted",{get:function getMuted(){return this._muted},
set:function setMuted(val){this._muted=!!val}});WebAudioBackend.prototype._audioProcess=function(event){var channel,input,output,i,playbackTime;if(typeof event.playbackTime==="number")playbackTime=event.playbackTime;else playbackTime=this._context.currentTime+this.bufferSize/this.rate;var expectedTime=this._playbackTimeAtBufferTail;if(expectedTime<playbackTime)this._delayedTime+=playbackTime-expectedTime;if(this._bufferQueue.sampleCount()<this.bufferSize)if(this.onstarved)this.onstarved();if(this._bufferQueue.sampleCount()<
this.bufferSize){for(channel=0;channel<this.channels;channel++){output=event.outputBuffer.getChannelData(channel);for(i=0;i<this.bufferSize;i++)output[i]=0}this._dropped++;return}var volume=this.muted?0:this.volume;var inputBuffer=this._bufferQueue.nextBuffer();if(inputBuffer[0].length<this.bufferSize)throw"Audio buffer not expected length.";for(channel=0;channel<this.channels;channel++){input=inputBuffer[channel];this._liveBuffer[channel].set(inputBuffer[channel]);output=event.outputBuffer.getChannelData(channel);
for(i=0;i<input.length;i++)output[i]=input[i]*volume}this._queuedTime+=this.bufferSize/this.rate;this._playbackTimeAtBufferTail=playbackTime+this.bufferSize/this.rate;if(this._bufferQueue.sampleCount()<Math.max(this.bufferSize,this.bufferThreshold))if(this.onbufferlow)nextTick(this.onbufferlow.bind(this))};WebAudioBackend.prototype._samplesQueued=function(){var bufferedSamples=this._bufferQueue.sampleCount();var remainingSamples=Math.floor(this._timeAwaitingPlayback()*this.rate);return bufferedSamples+
remainingSamples};WebAudioBackend.prototype._timeAwaitingPlayback=function(){return Math.max(0,this._playbackTimeAtBufferTail-this._context.currentTime)};WebAudioBackend.prototype.getPlaybackState=function(){return{playbackPosition:this._queuedTime-this._timeAwaitingPlayback(),samplesQueued:this._samplesQueued(),dropped:this._dropped,delayed:this._delayedTime}};WebAudioBackend.prototype.waitUntilReady=function(callback){callback()};WebAudioBackend.prototype.appendBuffer=function(sampleData){this._bufferQueue.appendBuffer(sampleData)};
WebAudioBackend.prototype.start=function(){this._node.onaudioprocess=this._audioProcess.bind(this);this._node.connect(this.output);this._playbackTimeAtBufferTail=this._context.currentTime};WebAudioBackend.prototype.stop=function(){if(this._node){var timeRemaining=this._timeAwaitingPlayback();if(timeRemaining>0){var samplesRemaining=Math.round(timeRemaining*this.rate),samplesAvailable=this._liveBuffer?this._liveBuffer[0].length:0;if(samplesRemaining>samplesAvailable){this._bufferQueue.prependBuffer(this._liveBuffer);
this._bufferQueue.prependBuffer(this._bufferQueue.createBuffer(samplesRemaining-samplesAvailable))}else this._bufferQueue.prependBuffer(this._bufferQueue.trimBuffer(this._liveBuffer,samplesAvailable-samplesRemaining,samplesRemaining));this._playbackTimeAtBufferTail-=timeRemaining}this._node.onaudioprocess=null;this._node.disconnect()}};WebAudioBackend.prototype.flush=function(){this._bufferQueue.flush()};WebAudioBackend.prototype.close=function(){this.stop();this._context=null};WebAudioBackend.prototype.onstarved=
null;WebAudioBackend.prototype.onbufferlow=null;WebAudioBackend.isSupported=function(){return!!AudioContext};WebAudioBackend.sharedAudioContext=null;WebAudioBackend.initSharedAudioContext=function(){if(!WebAudioBackend.sharedAudioContext)if(WebAudioBackend.isSupported()){var context=new AudioContext,node;if(context.createScriptProcessor)node=context.createScriptProcessor(1024,0,2);else if(context.createJavaScriptNode)node=context.createJavaScriptNode(1024,0,2);else throw new Error("Bad version of web audio API?");
node.connect(context.destination);node.disconnect();WebAudioBackend.sharedAudioContext=context}return WebAudioBackend.sharedAudioContext};module.exports=WebAudioBackend})()},function(module,exports){module.exports=function(){if(typeof window.setImmediate!=="undefined")return window.setImmediate;if(window&&window.postMessage){var nextTickQueue=[];window.addEventListener("message",function(event){if(event.source===window){var data=event.data;if(typeof data==="object"&&data.nextTickBrowserPingMessage){var callback=
nextTickQueue.pop();if(callback)callback()}}});return function(callback){nextTickQueue.push(callback);window.postMessage({nextTickBrowserPingMessage:true},document.location.toString())}}return function(callback){setTimeout(callback,0)}}()},function(module,exports,__webpack_require__){(function(){var dynamicaudio_swf=__webpack_require__(5);var nextTick=__webpack_require__(3);var FlashBackend=function(numChannels,sampleRate,options){options=options||{};var flashOptions={};if(typeof options.base==="string")flashOptions.swf=
options.base+"/"+dynamicaudio_swf;if(options.bufferSize)this.bufferSize=options.bufferSize|0;this._flashaudio=new DynamicAudio(flashOptions);this._flashBuffer="";this._flushTimeout=null;this._flushInterval=40;this._cachedFlashState=null;this._cachedFlashTime=0;this._cachedFlashInterval=40;this._waitUntilReadyQueue=[];this.onready=function(){this._flashaudio.flashElement.setBufferSize(this.bufferSize);this._flashaudio.flashElement.setBufferThreshold(this.bufferThreshold);while(this._waitUntilReadyQueue.length){var callback=
this._waitUntilReadyQueue.shift();callback.apply(this)}};this.onlog=function(msg){console.log("AudioFeeder FlashBackend: "+msg)};this.bufferThreshold=this.bufferSize*2;var events={"ready":"sync","log":"sync","starved":"sync","bufferlow":"async"};this._callbackName="AudioFeederFlashBackendCallback"+this._flashaudio.id;var self=this;window[this._callbackName]=function(eventName){var method=events[eventName],callback=this["on"+eventName];if(method&&callback)if(method==="async")nextTick(callback.bind(this));
else{callback.apply(this,Array.prototype.slice.call(arguments,1));this._flushFlashBuffer()}}.bind(this)};FlashBackend.prototype.rate=44100;FlashBackend.prototype.channels=2;FlashBackend.prototype.bufferSize=4096;FlashBackend.prototype._bufferThreshold=8192;Object.defineProperty(FlashBackend.prototype,"bufferThreshold",{get:function getBufferThreshold(){return this._bufferThreshold},set:function setBufferThreshold(val){this._bufferThreshold=val|0;this.waitUntilReady(function(){this._flashaudio.flashElement.setBufferThreshold(this._bufferThreshold)}.bind(this))}});
FlashBackend.prototype._volume=1;Object.defineProperty(FlashBackend.prototype,"volume",{get:function getVolume(){return this._volume},set:function setVolume(val){this._volume=+val;this.waitUntilReady(this._flashVolumeUpdate.bind(this))}});FlashBackend.prototype._muted=false;Object.defineProperty(FlashBackend.prototype,"muted",{get:function getMuted(){return this._muted},set:function setMuted(val){this._muted=!!val;this.waitUntilReady(this._flashVolumeUpdate.bind(this))}});FlashBackend.prototype._paused=
true;FlashBackend.prototype._flashVolumeUpdate=function(){if(this._flashaudio&&this._flashaudio.flashElement&&this._flashaudio.flashElement.setVolume)this._flashaudio.flashElement.setVolume(this.muted?0:this.volume)};FlashBackend.prototype._resampleFlash=function(samples){var sampleincr=1;var samplecount=samples[0].length;var newSamples=new Int16Array(samplecount*2);var chanLeft=samples[0];var chanRight=this.channels>1?samples[1]:chanLeft;var volume=this.muted?0:this.volume;var multiplier=volume*
16384;for(var s=0;s<samplecount;s++){var idx=s*sampleincr|0;var idx_out=s*2;newSamples[idx_out]=chanLeft[idx]*multiplier;newSamples[idx_out+1]=chanRight[idx]*multiplier}return newSamples};var hexDigits=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];var hexBytes=[];for(var i=0;i<256;i++)hexBytes[i]=hexDigits[i&15]+hexDigits[(i&240)>>4];function hexString(buffer){var samples=new Uint8Array(buffer);var digits="",len=samples.length;for(var i=0;i<len;i++)digits+=hexBytes[samples[i]];
return digits}FlashBackend.prototype._flushFlashBuffer=function(){var chunk=this._flashBuffer,flashElement=this._flashaudio.flashElement;if(this._cachedFlashState)this._cachedFlashState.samplesQueued+=chunk.length/8;this._flashBuffer="";this._flushTimeout=null;if(chunk.length>0)this.waitUntilReady(function(){flashElement.write(chunk)})};FlashBackend.prototype.appendBuffer=function(sampleData){var resamples=this._resampleFlash(sampleData);if(resamples.length>0){var str=hexString(resamples.buffer);
this._flashBuffer+=str;if(!this._flushTimeout)this._flushTimeout=setTimeout(this._flushFlashBuffer.bind(this),this._flushInterval)}};FlashBackend.prototype.getPlaybackState=function(){if(this._flashaudio&&this._flashaudio.flashElement&&this._flashaudio.flashElement.write){var now=Date.now(),delta=this._paused?0:now-this._cachedFlashTime,state;if(this._cachedFlashState&&delta<this._cachedFlashInterval){var cachedFlashState=this._cachedFlashState;state={playbackPosition:cachedFlashState.playbackPosition+
delta/1E3,samplesQueued:cachedFlashState.samplesQueued-Math.max(0,Math.round(delta*this.rate/1E3)),dropped:cachedFlashState.dropped,delayed:cachedFlashState.delayed}}else{state=this._flashaudio.flashElement.getPlaybackState();this._cachedFlashState=state;this._cachedFlashTime=now}state.samplesQueued+=this._flashBuffer.length/8;return state}else return{playbackPosition:0,samplesQueued:0,dropped:0,delayed:0}};FlashBackend.prototype.waitUntilReady=function(callback){if(this._flashaudio&&this._flashaudio.flashElement.write)callback.apply(this);
else this._waitUntilReadyQueue.push(callback)};FlashBackend.prototype.start=function(){this._flashaudio.flashElement.start();this._paused=false;this._cachedFlashState=null};FlashBackend.prototype.stop=function(){this._flashaudio.flashElement.stop();this._paused=true;this._cachedFlashState=null};FlashBackend.prototype.flush=function(){this._flashaudio.flashElement.flush();this._cachedFlashState=null};FlashBackend.prototype.close=function(){this.stop();var wrapper=this._flashaudio.flashWrapper;wrapper.parentNode.removeChild(wrapper);
this._flashaudio=null;delete window[this._callbackName]};FlashBackend.prototype.onstarved=null;FlashBackend.prototype.onbufferlow=null;FlashBackend.isSupported=function(){if(navigator.userAgent.indexOf("Trident")!==-1)try{var obj=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");return true}catch(e){return false}return false};function DynamicAudio(args){if(this instanceof arguments.callee){if(typeof this.init==="function")this.init.apply(this,args&&args.callee?args:arguments)}else return new arguments.callee(arguments)}
DynamicAudio.nextId=1;DynamicAudio.prototype={nextId:null,swf:dynamicaudio_swf,flashWrapper:null,flashElement:null,init:function(opts){var self=this;self.id=DynamicAudio.nextId++;if(opts&&typeof opts.swf!=="undefined")self.swf=opts.swf;self.flashWrapper=document.createElement("div");self.flashWrapper.id="dynamicaudio-flashwrapper-"+self.id;var s=self.flashWrapper.style;s.position="fixed";s.width="11px";s.height="11px";s.bottom=s.left="0px";s.overflow="hidden";self.flashElement=document.createElement("div");
self.flashElement.id="dynamicaudio-flashelement-"+self.id;self.flashWrapper.appendChild(self.flashElement);document.body.appendChild(self.flashWrapper);var id=self.flashElement.id;var params='<param name="FlashVars" value="objectId='+self.id+'">';self.flashWrapper.innerHTML="<object id='"+id+"' width='10' height='10' type='application/x-shockwave-flash' data='"+self.swf+"' style='visibility: visible;'><param name='allowscriptaccess' value='always'>"+params+"</object>";self.flashElement=document.getElementById(id)}};
module.exports=FlashBackend})()},function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"dynamicaudio.swf?version=0f98a83acdc72cf30968c16a018e1cf1"}])})},function(module,exports,__webpack_require__){module.exports=__webpack_require__.p+"dynamicaudio.swf?version=0f98a83acdc72cf30968c16a018e1cf1"},function(module,exports){function Bisector(options){var start=options.start,end=options.end,position=0,self=this,n=0;function iterate(){n++;position=Math.floor((start+end)/2);return options.process(start,
end,position)}self.start=function(){iterate();return self};self.left=function(){end=position;return iterate()};self.right=function(){start=position;return iterate()}}module.exports=Bisector},function(module,exports,__webpack_require__){var OGVLoader=__webpack_require__(3);var OGVWrapperCodec=function(options){options=options||{};var self=this,suffix="?version="+encodeURIComponent("1.4.2-20170425024925-504d7197"),base=typeof options.base==="string"?options.base+"/":"",type=typeof options.type==="string"?
options.type:"video/ogg",processing=false,demuxer=null,videoDecoder=null,audioDecoder=null,flushIter=0;function flushSafe(func){var savedFlushIter=flushIter;return function(arg){if(flushIter<=savedFlushIter)func(arg)}}var loadedMetadata=false;Object.defineProperty(self,"loadedMetadata",{get:function(){return loadedMetadata}});Object.defineProperty(self,"processing",{get:function(){return processing}});Object.defineProperty(self,"duration",{get:function(){if(self.loadedMetadata)return demuxer.duration;
else return NaN}});Object.defineProperty(self,"hasAudio",{get:function(){return self.loadedMetadata&&!!audioDecoder}});Object.defineProperty(self,"audioReady",{get:function(){return self.hasAudio&&demuxer.audioReady}});Object.defineProperty(self,"audioTimestamp",{get:function(){return demuxer.audioTimestamp}});Object.defineProperty(self,"audioFormat",{get:function(){if(self.hasAudio)return audioDecoder.audioFormat;else return null}});Object.defineProperty(self,"audioBuffer",{get:function(){if(self.hasAudio)return audioDecoder.audioBuffer;
else return null}});Object.defineProperty(self,"hasVideo",{get:function(){return self.loadedMetadata&&!!videoDecoder}});Object.defineProperty(self,"frameReady",{get:function(){return self.hasVideo&&demuxer.frameReady}});Object.defineProperty(self,"frameTimestamp",{get:function(){return demuxer.frameTimestamp}});Object.defineProperty(self,"keyframeTimestamp",{get:function(){return demuxer.keyframeTimestamp}});Object.defineProperty(self,"nextKeyframeTimestamp",{get:function(){return demuxer.nextKeyframeTimestamp}});
Object.defineProperty(self,"videoFormat",{get:function(){if(self.hasVideo)return videoDecoder.videoFormat;else return null}});Object.defineProperty(self,"frameBuffer",{get:function(){if(self.hasVideo)return videoDecoder.frameBuffer;else return null}});Object.defineProperty(self,"seekable",{get:function(){return demuxer.seekable}});self.init=function(callback){var demuxerClassName;if(options.type==="video/webm")demuxerClassName=options.wasm?"OGVDemuxerWebMW":"OGVDemuxerWebM";else demuxerClassName=
options.wasm?"OGVDemuxerOggW":"OGVDemuxerOgg";processing=true;OGVLoader.loadClass(demuxerClassName,function(demuxerClass){demuxer=new demuxerClass;demuxer.onseek=function(offset){if(self.onseek)self.onseek(offset)};demuxer.init(function(){processing=false;callback()})})};self.close=function(){if(demuxer){demuxer.close();demuxer=null}if(videoDecoder){videoDecoder.close();videoDecoder=null}if(audioDecoder){audioDecoder.close();audioDecoder=null}};self.receiveInput=function(data,callback){demuxer.receiveInput(data,
callback)};var audioClassMap={vorbis:options.wasm?"OGVDecoderAudioVorbisW":"OGVDecoderAudioVorbis",opus:options.wasm?"OGVDecoderAudioOpusW":"OGVDecoderAudioOpus"};function loadAudioCodec(callback){if(demuxer.audioCodec){var className=audioClassMap[demuxer.audioCodec];processing=true;OGVLoader.loadClass(className,function(audioCodecClass){var audioOptions={};if(demuxer.audioFormat)audioOptions.audioFormat=demuxer.audioFormat;audioDecoder=new audioCodecClass(audioOptions);audioDecoder.init(function(){loadedAudioMetadata=
audioDecoder.loadedMetadata;processing=false;callback()})},{worker:options.worker})}else callback()}var videoClassMap={theora:options.wasm?"OGVDecoderVideoTheoraW":"OGVDecoderVideoTheora",vp8:options.wasm?"OGVDecoderVideoVP8W":options.threading?"OGVDecoderVideoVP8MT":"OGVDecoderVideoVP8",vp9:options.wasm?"OGVDecoderVideoVP9W":options.threading?"OGVDecoderVideoVP9MT":"OGVDecoderVideoVP9"};function loadVideoCodec(callback){if(demuxer.videoCodec){var className=videoClassMap[demuxer.videoCodec];processing=
true;OGVLoader.loadClass(className,function(videoCodecClass){var videoOptions={};if(demuxer.videoFormat)videoOptions.videoFormat=demuxer.videoFormat;if(options.memoryLimit)videoOptions.memoryLimit=options.memoryLimit;videoDecoder=new videoCodecClass(videoOptions);videoDecoder.init(function(){loadedVideoMetadata=videoDecoder.loadedMetadata;processing=false;callback()})},{worker:options.worker&&!options.threading})}else callback()}var loadedDemuxerMetadata=false,loadedAudioMetadata=false,loadedVideoMetadata=
false,loadedAllMetadata=false;self.process=function(callback){if(processing)throw new Error("reentrancy fail on OGVWrapperCodec.process");processing=true;var videoPacketCount=demuxer.videoPackets.length,audioPacketCount=demuxer.audioPackets.length,start=window.performance?performance.now():Date.now();function finish(result){processing=false;var delta=(window.performance?performance.now():Date.now())-start;if(delta>8)console.log("slow demux in "+delta+" ms; "+(demuxer.videoPackets.length-videoPacketCount)+
" +video packets, "+(demuxer.audioPackets.length-audioPacketCount)+" +audio packets");callback(result)}function doProcessData(){demuxer.process(finish)}if(demuxer.loadedMetadata&&!loadedDemuxerMetadata)loadAudioCodec(function(){loadVideoCodec(function(){loadedDemuxerMetadata=true;loadedAudioMetadata=!audioDecoder;loadedVideoMetadata=!videoDecoder;loadedAllMetadata=loadedAudioMetadata&&loadedVideoMetadata;finish(true)})});else if(loadedDemuxerMetadata&&!loadedAudioMetadata)if(audioDecoder.loadedMetadata){loadedAudioMetadata=
true;loadedAllMetadata=loadedAudioMetadata&&loadedVideoMetadata;finish(true)}else if(demuxer.audioReady)demuxer.dequeueAudioPacket(function(packet){audioDecoder.processHeader(packet,function(ret){finish(true)})});else doProcessData();else if(loadedAudioMetadata&&!loadedVideoMetadata)if(videoDecoder.loadedMetadata){loadedVideoMetadata=true;loadedAllMetadata=loadedAudioMetadata&&loadedVideoMetadata;finish(true)}else if(demuxer.frameReady){processing=true;demuxer.dequeueVideoPacket(function(packet){videoDecoder.processHeader(packet,
function(){finish(true)})})}else doProcessData();else if(loadedVideoMetadata&&!self.loadedMetadata&&loadedAllMetadata){loadedMetadata=true;finish(true)}else if(self.loadedMetadata&&(!self.hasAudio||demuxer.audioReady)&&(!self.hasVideo||demuxer.frameReady))finish(true);else doProcessData()};self.decodeFrame=function(callback){var cb=flushSafe(callback),timestamp=self.frameTimestamp,keyframeTimestamp=self.keyframeTimestamp;demuxer.dequeueVideoPacket(function(packet){videoDecoder.processFrame(packet,
function(ok){if(videoDecoder.frameBuffer){videoDecoder.frameBuffer.timestamp=timestamp;videoDecoder.frameBuffer.keyframeTimestamp=keyframeTimestamp}cb(ok)})})};self.decodeAudio=function(callback){var cb=flushSafe(callback);demuxer.dequeueAudioPacket(function(packet){audioDecoder.processAudio(packet,cb)})};self.discardFrame=function(callback){demuxer.dequeueVideoPacket(function(packet){callback()})};self.discardAudio=function(callback){demuxer.dequeueAudioPacket(function(packet){callback()})};self.flush=
function(callback){flushIter++;demuxer.flush(callback)};self.getKeypointOffset=function(timeSeconds,callback){demuxer.getKeypointOffset(timeSeconds,callback)};self.seekToKeypoint=function(timeSeconds,callback){demuxer.seekToKeypoint(timeSeconds,flushSafe(callback))};self.onseek=null;Object.defineProperty(self,"demuxerCpuTime",{get:function(){if(demuxer)return demuxer.cpuTime;else return 0}});Object.defineProperty(self,"audioCpuTime",{get:function(){if(audioDecoder)return audioDecoder.cpuTime;else return 0}});
Object.defineProperty(self,"videoCpuTime",{get:function(){if(videoDecoder)return videoDecoder.cpuTime;else return 0}});return self};module.exports=OGVWrapperCodec}])});
